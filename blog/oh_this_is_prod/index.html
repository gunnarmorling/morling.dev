<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Oh... This is Prod?! - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Oh... This is Prod?!" />
<meta property="og:description" content="
I strongly believe that you should avoid connecting to production environments from local developer machines as much as possible.
But sometimes, e.g. in order to analyse some specific kinds of failures,
doing so can be inevitable.


Now, if this is the case, I really, really want to be sure that I’m aware of the environment I am working in.
I absolutely want to avoid a situation as in the catchy title of this post,
when for instance you realize that you just ran some integration test against a production environment.
In the context of working with the AWS CLI tool this means I’d like to be aware of the currently active profile by means of coloring my shell accordingly.
Here’s how I’ve set this up using iTerm2 and zsh.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.morling.dev/blog/oh_this_is_prod/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-01-05T22:10:00+01:00" />
<meta property="article:modified_time" content="2023-01-05T22:10:00+01:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Oh... This is Prod?!"/>
<meta name="twitter:description" content="
I strongly believe that you should avoid connecting to production environments from local developer machines as much as possible.
But sometimes, e.g. in order to analyse some specific kinds of failures,
doing so can be inevitable.


Now, if this is the case, I really, really want to be sure that I’m aware of the environment I am working in.
I absolutely want to avoid a situation as in the catchy title of this post,
when for instance you realize that you just ran some integration test against a production environment.
In the context of working with the AWS CLI tool this means I’d like to be aware of the currently active profile by means of coloring my shell accordingly.
Here’s how I’ve set this up using iTerm2 and zsh.
"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
 
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/main.css" />

	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/base16.dark.css" />
	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/morlingdev.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>

	<script src="https://www.morling.dev//js/main.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">Oh... This is Prod?!</h1>
				<div class="meta">Posted at Jan 5, 2023</div>
			</div>

			<div class="markdown">
				<div class="paragraph">
<p>I strongly believe that you should avoid connecting to production environments from local developer machines as much as possible.
But sometimes, e.g. in order to analyse some specific kinds of failures,
doing so can be inevitable.</p>
</div>
<div class="paragraph">
<p>Now, if this is the case, I really, really want to be sure that I’m aware of the environment I am working in.
I absolutely want to avoid a situation as in the catchy title of this post,
when for instance you realize that you just ran some integration test against a production environment.
In the context of working with the AWS CLI tool this means I’d like to be aware of the currently active <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">profile</a> by means of coloring my shell accordingly.
Here’s how I’ve set this up using <a href="https://iterm2.com/">iTerm2</a> and <a href="https://www.zsh.org/">zsh</a>.</p>
</div>
<div class="paragraph">
<p>The first step is to create a <a href="https://iterm2.com/documentation-preferences-profiles-general.html">profile</a> in iTerm2 for each separate environment which you can easily recognize and tell apart.
In my case, I’ve set up two profiles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A &#34;Dev&#34; profile with a dark green background</p>
</li>
<li>
<p>A &#34;Prod&#34; profile with a dark red background</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I have also added badges with the profile name which is shown a the upper right corner of the window for further emphasis.</p>
</div>
<div class="paragraph">
<p>While you can specify the right profile to use for each single invocation of the <em>aws</em> tool, this quickly becomes cumbersome.
So I am enabling profiles using the <code>AWS_PROFILE</code> environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nb">export </span><span class="nv">AWS_PROFILE</span><span class="o">=</span>dev
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever the value of this environment variable changes, I would like to activate the corresponding iTerm2 profile.
This can be done programmatically by echo-ing a specific escape sequence which is interpreted by the terminal emulator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">&#34;</span><span class="se">\0</span><span class="s2">33]50;SetProfile=Dev</span><span class="se">\a</span><span class="s2">&#34;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make sure the right profile is set, I am using the <code>precmd</code> <a href="https://zsh.sourceforge.io/Doc/Release/Functions.html">hook function</a> in zsh.
It is invoked every time before the prompt is displayed.
Just add the following to your <em>.zshrc</em> file
(if you have multiple actions you’d like to execute,
it can be worthwhile to set them up as separate hook functions,
as described in <a href="https://stephencharlesweiss.com/zsh-hooks">this post</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre>precmd <span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$AWS_PROFILE</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;dev&#34;</span> <span class="o">]</span>
    <span class="k">then
        </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">&#34;</span><span class="se">\0</span><span class="s2">33]50;SetProfile=Dev</span><span class="se">\a</span><span class="s2">&#34;</span>
    <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$AWS_PROFILE</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;prod&#34;</span> <span class="o">]</span>
    <span class="k">then
        </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">&#34;</span><span class="se">\0</span><span class="s2">33]50;SetProfile=Prod</span><span class="se">\a</span><span class="s2">&#34;</span>
    <span class="k">else
        </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">&#34;</span><span class="se">\0</span><span class="s2">33]50;SetProfile=Default</span><span class="se">\a</span><span class="s2">&#34;</span>
    <span class="k">fi</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>With that configuration in place (either source your <em>.zshrc</em> or open a new session for activating it),
choosing a specific AWS profile automatically triggers the activation of the matching profile in iTerm2:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/shell_profile_selection.gif" alt="shell profile selection"/>
</div>
</div>
<div class="paragraph">
<p>That way, it’s very apparent which AWS profile currently is active, substantially reducing the risk for making any stupid mistakes.</p>
</div>
			</div>

			<div class="post-tags">
				
					
				
			</div>
		</div><div id="disqus_thread">
  <script src="https://giscus.app/client.js"
    data-repo="gunnarmorling/discussions.morling.dev"
    data-repo-id="R_kgDOGXzqNQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOGXzqNc4B_2Pq"
    data-mapping="title"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
  </script>
</div>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
