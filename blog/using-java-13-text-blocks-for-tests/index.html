<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Using Java 13 Text Blocks (Only) for Your Tests - Gunnar Morling</title>
	<link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
	<link rel="shortcut icon" href="/favicon/favicon.ico" />

	<meta name="viewport" content="width=device-width, initial-scale=1">

	
	<link rel="preload" href="/fonts/raleway-v37-latin-200.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/raleway-v37-latin-300.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/raleway-v37-latin-regular.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="preload" href="/fonts/lato-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lato-latin-400-italic.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lato-latin-700-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lato-latin-700-italic.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="preload" href="/fonts/lora-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lora-latin-400-italic.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lora-latin-700-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lora-latin-700-italic.woff2" as="font" type="font/woff2" crossorigin><meta property="og:url" content="https://www.morling.dev/blog/using-java-13-text-blocks-for-tests/">
  <meta property="og:site_name" content="Gunnar Morling">
  <meta property="og:title" content="Using Java 13 Text Blocks (Only) for Your Tests">
  <meta property="og:description" content=" When Java 9 was introduced in 2017, it was the last major version published under the old release scheme. Since then, a six month release cadence has been adopted. This means developers don’t have to …">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="blog">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2020-01-13T17:30:00&#43;01:00">
    <meta property="article:modified_time" content="2020-01-13T17:30:00&#43;01:00">
<meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Using Java 13 Text Blocks (Only) for Your Tests">
  <meta name="twitter:description" content=" When Java 9 was introduced in 2017, it was the last major version published under the old release scheme. Since then, a six month release cadence has been adopted. This means developers don’t have to …">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.min.efd5060e5dbdbc4655a896b01b99c2b759dc5710f5cfda5ed34c2259de325469.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.min.7e747dab5a47b967474cfdc64085734aa21b459c2bc3519033238d0258bb7dcc.css" />

	
	<link rel="stylesheet" type="text/css" href="/css/base16.dark.min.c40398d5ec04ac387c57141dc29e820fc4012da1cf2af8235004fc9945fa76a8.css" />
	
	<link rel="stylesheet" type="text/css" href="/css/morlingdev.min.f16130e3c2c4db8c103eb366ce03dbe6d7523107bfdf40d0221505e1860c9401.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>
	<script src="/js/main.min.9ee619eea7f51473f4284ef86c76bdb1b0089e19781ca97275924edf53be5bd4.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">Using Java 13 Text Blocks (Only) for Your Tests</h1>
				<div class="post-meta-line">
					<span class="meta">Posted at Jan 13, 2020</span>
					
					<span class="post-tags-inline">
						
						<a href="/tags/java">java</a>
						
						<a href="/tags/testing">testing</a>
						
						<a href="/tags/language-features">language-features</a>
						
					</span>
					
				</div>
			</div>

			<div class="post-content">
				<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_an_example">An Example</a></li>
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_should_you_do_this">Should You Do This?</a></li>
</ul>
</div>
<div class="paragraph">
<p>When Java 9 was introduced in 2017,
it was the last major version published under the old release scheme.
Since then, a <a href="https://www.infoq.com/news/2017/09/Java6Month/">six month release cadence</a> has been adopted.
This means developers don’t have to wait years for new APIs and language features,
but they can get their hands onto the latest additions twice a year.
In this post I’d like to describe how you can try out new language features such as <a href="http://openjdk.java.net/jeps/355">Java 13 text blocks</a> in the test code of your project,
while keeping your main code still compatible with older Java versions.</p>
</div>
<div class="paragraph">
<p>One goal of the increased release cadence is to shorten the feedback loop for the OpenJDK team:
have developers in the field try out new functionality early on, collect feedback based on that, adjust as needed.
To aid with that process, the JDK has two means of publishing preliminary work before new APIs and language features are cast in stone:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://openjdk.java.net/jeps/11">Incubator JDK modules</a></p>
</li>
<li>
<p><a href="https://openjdk.java.net/jeps/12">Preview language and VM features</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example for the former is the new HTTP client API, which was an incubator module in JDK 9 and 10,
before it got <a href="http://openjdk.java.net/jeps/321">standardized</a> as a regular API in JDK 11.
Examples for preview language features are <a href="http://openjdk.java.net/jeps/325">switch expressions</a>
(added as a preview feature in Java 12) and text blocks (added in Java 13).</p>
</div>
<div class="paragraph">
<p>Now especially text blocks are a feature which many developers have missed in Java for a long time.
They are really useful when embedding other languages, or just any kind of longer text into your Java program,
e.g. multi-line SQL statements, JSON documents and others.
So you might want to go and use them as quickly as possible,
but depending on your specific situation and requirements, you may no be able to move to Java 13 just yet.</p>
</div>
<div class="paragraph">
<p>In particular when working on libraries, compatibility with older Java versions is a high priority in order to not cut off a large number of potential users.
E.g. in the JetBrains <a href="https://www.jetbrains.com/lp/devecosystem-2019/java/">Developer Ecosystem Survey</a> from early 2019,
83% of participants said that Java 8 is a version they regularly use.
This matches with what I’ve observed myself during conversations e.g. at conferences.
Now this share may have reduced a bit since then
(I couldn’t find any newer numbers),
but at this point in time it still seems save to say that libraries should support Java 8 to not limit their audience in a signficant way.</p>
</div>
<div class="paragraph">
<p>So while <em>building</em> on Java 13 is fine,
requiring it at <em>runtime</em> for libraries isn’t.
Does this mean as a library author you cannot use text blocks then for many years to come?
For your main code (i.e. the one shipped to users) it indeed does mean that,
but things look different when it comes to test code.</p>
</div>
<div class="sect1">
<h2 id="_an_example">An Example<a class="anchor" href="#_an_example"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>One case where text blocks come in extremely handy is testing of REST APIs,
where JSON requests need to created and responses may have to be compared to a JSON string with the expected value.
Here’s an example of using text blocks in a test of a <a href="https://quarkus.io/">Quarkus-based</a> REST service,
implemented using <a href="http://rest-assured.io/">RESTAssured</a> and <a href="https://github.com/skyscreamer/JSONassert">JSONAssert</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="nd">@QuarkusTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoResourceTest</span> <span class="o">{</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">canPostNewTodoAndReceiveId</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">given</span><span class="o">()</span>
      <span class="o">.</span><span class="na">when</span><span class="o">()</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="sh">&#34;&#34;&#34;                                          <i class="conum" data-value="1"></i><b>(1)</b>
              {
                &#34;title&#34; : &#34;Learn Java&#34;,
                &#34;completed&#34; : false
              }
              &#34;&#34;&#34;</span>
        <span class="o">)</span>
        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">ContentType</span><span class="o">.</span><span class="na">JSON</span><span class="o">)</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">then</span><span class="o">()</span>
        <span class="o">.</span><span class="na">statusCode</span><span class="o">(</span><span class="mi">201</span><span class="o">)</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">matchesJson</span><span class="o">(</span><span class="sh">&#34;&#34;&#34;                              <i class="conum" data-value="2"></i><b>(2)</b>
                          {
                            &#34;id&#34; : 1,
                            &#34;title&#34; : &#34;Learn Java&#34;,
                            &#34;completed&#34; : false
                          }
                          &#34;&#34;&#34;</span><span class="o">)</span>
        <span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Text block with the JSON request to send</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Text block with the expected JSON response</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Indeed that’s much nicer to read, e.g. when comparing the request JSON to the code you’d typically write without text blocks.
Concatenating multiple lines, escaping quotes and explicitly specifying line breaks make this quite cumbersome:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="o">.</span><span class="na">body</span><span class="o">(</span>
      <span class="s">&#34;{\n&#34;</span> <span class="o">+</span>
      <span class="s">&#34;  \&#34;title\&#34; : \&#34;Learn Java 13\&#34;,\n&#34;</span> <span class="o">+</span>
      <span class="s">&#34;  \&#34;completed\&#34; : false\n&#34;</span> <span class="o">+</span>
      <span class="s">&#34;}&#34;</span>
<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let’s see what’s needed in terms of configuration to enable usage of Java 13 text blocks for tests,
while keeping the main code of a project compatible with Java 8.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration<a class="anchor" href="#_configuration"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Two options of the Java compiler <code>javac</code> come into play here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--release</code>: specifies the Java version to compile for</p>
</li>
<li>
<p><code>--enable-preview</code>: allows to use language features currently in &#34;preview&#34; status such as text blocks as of Java 13/14</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>--release</code> option was introduced in Java 9 and should be preferred over the more widely known pair of <code>--source</code> and <code>--target</code>.
The reason being that <code>--release</code> will prevent any accidental usage of APIs only introduced in later versions.</p>
</div>
<div class="paragraph">
<p>E.g. say you were to write code such as <code>List.of(&#34;Foo&#34;, &#34;Bar&#34;)</code>;
the <code>of()</code> methods on <code>java.util.List</code> were only introduced in Java 9, so compiling with <code>--release 8</code> will raise a compilation error in this case.
When using the older options, this situation wouldn’t be detected at compile time,
making the problem only apparent when actually running the application on the older Java version.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Build tools typically allow to use different configurations for the compilation of main and test code.
E.g. here is what you’d use for Maven
(you can find the complete source code of the example in <a href="https://github.com/gunnarmorling/jdk13-text-blocks">this GitHub repo</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre>...
<span class="nt">&lt;properties&gt;</span>
  ...
  <span class="nt">&lt;maven.compiler.release&gt;</span>8<span class="nt">&lt;/maven.compiler.release&gt;</span>      <i class="conum" data-value="1"></i><b>(1)</b>
  ...
<span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;build&gt;</span>
  <span class="nt">&lt;plugins&gt;</span>
    ...
    <span class="nt">&lt;plugin&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
          <span class="nt">&lt;id&gt;</span>default-testCompile<span class="nt">&lt;/id&gt;</span>
          <span class="nt">&lt;configuration&gt;</span>
            <span class="nt">&lt;release&gt;</span>13<span class="nt">&lt;/release&gt;</span>                         <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="nt">&lt;compilerArgs&gt;</span>--enable-preview<span class="nt">&lt;/compilerArgs&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
          <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/execution&gt;</span>
      <span class="nt">&lt;/executions&gt;</span>
    <span class="nt">&lt;/plugin&gt;</span>
    ...
  <span class="nt">&lt;/plugins&gt;</span>
  ...
<span class="nt">&lt;/build&gt;</span>
...
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Compile for release 8 by default, i.e. the main code</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Compile test code for release 13</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Also pass the <code>--enable-preview</code> option when compiling the test code</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Also at runtime preview features must be explicitly enabled.
Therefore the <code>java</code> command must be accordingly configured when executing the tests,
e.g. like so when using the Maven Surefire plug-in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>...
<span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.22.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;argLine&gt;</span>--enable-preview<span class="nt">&lt;/argLine&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
...
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration in place,
text blocks can now be used in tests as the one above,
but not in the main code of the program.
Doing so would result in a compilation error.</p>
</div>
<div class="paragraph">
<p>Note your IDE might still let you do this kind of mistake.
At least Eclipse chose for me the maximum of main (8) and test code (13) release levels when importing the project.
But running the build on the command line via Maven or on your CI server will detect this situation.</p>
</div>
<div class="paragraph">
<p>As Java 13 now is required to <em>build</em> this code base,
it’s a good idea to make this prerequisite explicit in the build process itself.
The Maven <a href="https://maven.apache.org/enforcer/index.html">enforcer plug-in</a> comes in handy for that,
allowing to express this requirement using its <a href="https://maven.apache.org/enforcer/enforcer-rules/requireJavaVersion.html">Java version rule</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre>...
<span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>maven-enforcer-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>3.0.0-M3<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
    <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>enforce-java<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>enforce<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;rules&gt;</span>
          <span class="nt">&lt;requireJavaVersion&gt;</span>
            <span class="nt">&lt;version&gt;</span>[13,)<span class="nt">&lt;/version&gt;</span>
          <span class="nt">&lt;/requireJavaVersion&gt;</span>
        <span class="nt">&lt;/rules&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
...
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The plug-in will fail the build when being run on a version before Java 13.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_should_you_do_this">Should You Do This?<a class="anchor" href="#_should_you_do_this"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Having seen how you can use preview features in test code, the question is:
should you actually do this?
A few things should be kept in mind for answering that.
First of all, preview features are really that, a <strong>preview</strong>.
This means that details may change in future Java revisions.
Or, albeit unlikely,
such feature may even be dropped altogether,
should the JDK team arrive at the conclusion that it is fundamentally flawed.</p>
</div>
<div class="paragraph">
<p>Another important factor is the minimum Java language version supported by the JDK compiler.
As of Java 13, the oldest supported release is 7;
i.e. using JDK 13, you can produce byte code that can be run with Java versions as old as Java 7.
In order to keep the Java compiler maintainable, support for older versions is dropped every now and then.
Right now, there’s no formal process in place which would describe when support for a specific version is going to be removed
(defining such policy is the goal of <a href="https://openjdk.java.net/jeps/182">JEP 182</a>).</p>
</div>
<div class="paragraph">
<p>As per JDK developer Joe Darcy, &#34;<a href="https://mail.openjdk.java.net/pipermail/compiler-dev/2020-January/014206.html">there are no plans to remove support for --release 7 in JDK 15</a>&#34;.
Conversely, this means that support for release 7 theoretically <em>could</em> be removed in JDK 16 and support for release 8 <em>could</em> be removed in JDK 17.
In that case you’d be caught between a rock and a hard place:
Once you’re on a non-LTS (&#34;long-term support&#34;) release like JDK 13, you’ll need to upgrade to JDK 14, 15 etc. as soon as they are out,
in order to not be cut off from bug fixes and security patches.
Now while doing so, you’d be forced to increase the release level of your main code, once support for release 8 gets dropped, which may not desirable.
Or you’d have to apply some nice awk/sed magic to replace all those shiny text blocks with traditional concatenated and escaped strings,
so you can go back to the current LTS release, Java 11.
Not nice, but surely doable.</p>
</div>
<div class="paragraph">
<p>That being said, this all doesn’t seem like a likely scenario to me.
JEP 182 expresses a desire &#34;that source code 10 or more years old should still be able to be compiled&#34;;
hence I think it’s save to assume that JDK 17 (the next release planned to receive long-term support) will still support release 8,
which will be seven years old when 17 gets released as planned in September 2021.
In that case you’d be on the safe side, receiving update releases and being able to keep your main code Java 8 compatible for quite a few years to come.</p>
</div>
<div class="paragraph">
<p>Needless to say, it’s a call that you need to make, deciding for yourself wether the benefits of using new language features such as text blocks is worth it in your specific situation or not.</p>
</div>
</div>
</div>
			</div>

			
			
			
			<div class="related-posts">
				<h3>Read Next</h3>
				<ul>
					
					<li><a href="/blog/towards-continuous-performance-regression-testing/">Towards Continuous Performance Regression Testing</a> <span class="meta">Dec 16, 2020</span></li>
					
					<li><a href="/blog/quarkus-and-testcontainers/">Quarkus and Testcontainers</a> <span class="meta">Nov 28, 2020</span></li>
					
					<li><a href="/blog/zipping-gatherer/">A Zipping Gatherer</a> <span class="meta">Mar 18, 2024</span></li>
					
				</ul>
			</div>
			
			
		</div>

		<div class="post-footer">
			<div style="display: flex; align-items: center; gap: 1rem;">
				<div class="header-image-container" style="flex-shrink: 0;">
					<img class="footer-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
				</div>
				<p style="margin: 0;">Gunnar Morling is an open-source software engineer in the Java and data streaming space. He currently works as a Technologist for Confluent. In his past role at Decodable he focused on developer outreach and helped them build their stream processing platform based on Apache Flink. Prior to that, he spent ten years at Red Hat, where he led the Debezium project, a platform for change data capture.</p>
			</div>
		</div>

		
		
		<div class="post-discussions">
			<p>Comment below, or join the discussion on
			<a href="https://hn.algolia.com/?query=morling.dev/blog/using-java-13-text-blocks-for-tests/">Hacker News</a>,
			<a href="https://lobste.rs/search?q=domain:morling.dev+title:%22Using%20Java%2013%20Text%20Blocks%20%28Only%29%20for%20Your%20Tests%22&what=stories">Lobsters</a>, and
			<a href="https://www.reddit.com/search/?q=url:morling.dev/blog/using-java-13-text-blocks-for-tests/">Reddit</a>.
			</p>
		</div>
		<div id="disqus_thread"></div>

<script>
  
  window.addEventListener('load', function() {
    
    setTimeout(function() {
      const commentsContainer = document.getElementById('disqus_thread');
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'gunnarmorling/discussions.morling.dev');
      script.setAttribute('data-repo-id', 'R_kgDOGXzqNQ');
      script.setAttribute('data-category', 'Announcements');
      script.setAttribute('data-category-id', 'DIC_kwDOGXzqNc4B_2Pq');
      script.setAttribute('data-mapping', 'title');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-theme', 'light');
      script.setAttribute('data-lang', 'en');
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;
      commentsContainer.appendChild(script);
    }, 100);
  });
</script>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
