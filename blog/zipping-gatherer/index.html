<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>A Zipping Gatherer - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1">

	
	<link rel="preload" href="/fonts/raleway-v37-latin-200.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/raleway-v37-latin-300.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/raleway-v37-latin-regular.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="preload" href="/fonts/lato-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lato-latin-400-italic.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lato-latin-700-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lato-latin-700-italic.woff2" as="font" type="font/woff2" crossorigin>

	<link rel="preload" href="/fonts/lora-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lora-latin-400-italic.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lora-latin-700-normal.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/lora-latin-700-italic.woff2" as="font" type="font/woff2" crossorigin><meta property="og:url" content="https://www.morling.dev/blog/zipping-gatherer/">
  <meta property="og:site_name" content="Gunnar Morling">
  <meta property="og:title" content="A Zipping Gatherer">
  <meta property="og:description" content=" The other day, I was looking for means of zipping two Java streams: connecting them element by element—​essentially a join based on stream offset position—​and emitting an output stream with the …">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="blog">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-03-18T18:12:00&#43;01:00">
    <meta property="article:modified_time" content="2024-03-18T18:12:00&#43;01:00">
<meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="A Zipping Gatherer">
  <meta name="twitter:description" content=" The other day, I was looking for means of zipping two Java streams: connecting them element by element—​essentially a join based on stream offset position—​and emitting an output stream with the …">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.min.efd5060e5dbdbc4655a896b01b99c2b759dc5710f5cfda5ed34c2259de325469.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.min.59aa0509fe392f7421b53571b18ca50d23acb3dc5444249945a674f0ef9c7e36.css" />

	
	<link rel="stylesheet" type="text/css" href="/css/base16.dark.min.c40398d5ec04ac387c57141dc29e820fc4012da1cf2af8235004fc9945fa76a8.css" />
	
	<link rel="stylesheet" type="text/css" href="/css/morlingdev.min.c0b12fef85d2653c45f7c39d936e9526ec09724b52aa6f89da7958dc0f162a5f.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>
	<script src="/js/main.min.9ee619eea7f51473f4284ef86c76bdb1b0089e19781ca97275924edf53be5bd4.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">A Zipping Gatherer</h1>
				<div class="post-meta-line">
					<span class="meta">Posted at Mar 18, 2024</span>
					
					<span class="post-tags-inline">
						
						<a href="/tags/java">java</a>
						
						<a href="/tags/streams">streams</a>
						
						<a href="/tags/language-features">language-features</a>
						
					</span>
					
				</div>
			</div>

			<div class="post-content">
				<div class="paragraph">
<p>The other day, I was looking for means of <a href="https://twitter.com/gunnarmorling/status/1764305703047438361">zipping two Java streams</a>:
connecting them element by element—​essentially a join based on stream offset position—​and emitting an output stream with the results.
Unfortunately, there is no <code>zip()</code> method offered by the Java Streams API itself.
While it was considered for inclusion in early preview versions,
the method was removed before the API went GA with Java 8 and you have to resort to 3rd party libraries such as <a href="https://guava.dev/releases/snapshot-jre/api/docs/com/google/common/collect/Streams.html#zip(java.util.stream.Stream,java.util.stream.Stream,java.util.function.BiFunction)">Google Guava</a> if you need this functionality.</p>
</div>
<div class="paragraph">
<p>Java 22, scheduled for release later this week,
promises to improve the situation here.
It introduces a preview API for so-called stream <em>gatherers</em>
(<a href="https://openjdk.org/jeps/461">JEP 461</a>).
Similar to how collectors allow you to implement custom <em>terminal</em> operations on Java streams,
gatherers let you add custom <em>intermediary</em> operations to a stream pipeline,
providing an extension point for adding stream operations such as <code>distinct()</code> or <code>window()</code>,
without having to bake them into the API itself.
This sounds pretty much like what we need for a <code>zip()</code> method, doesn’t it?</p>
</div>
<div class="paragraph">
<p>So I spent some time studying the JEP and here’s the basic implementation I came up with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="n">record</span> <span class="nc">ObjToObjZipper</span><span class="o">&lt;</span><span class="no">T1</span><span class="o">,</span> <span class="no">T2</span><span class="o">,</span> <span class="no">R</span><span class="o">&gt;(</span>
    <span class="nc">Stream</span><span class="o">&lt;</span><span class="no">T2</span><span class="o">&gt;</span> <span class="n">other</span><span class="o">,</span>
    <span class="nc">BiFunction</span><span class="o">&lt;</span><span class="no">T1</span><span class="o">,</span> <span class="no">T2</span><span class="o">,</span> <span class="no">R</span><span class="o">&gt;</span> <span class="n">zipperFunction</span><span class="o">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="kd">implements</span> <span class="nc">Gatherer</span><span class="o">&lt;</span><span class="no">T1</span><span class="o">,</span> <span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">T2</span><span class="o">&gt;,</span> <span class="no">R</span><span class="o">&gt;</span> <span class="o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">T2</span><span class="o">&gt;&gt;</span> <span class="nf">initializer</span><span class="o">()</span> <span class="o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="k">return</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">other</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">Integrator</span><span class="o">&lt;</span><span class="nc">Iterator</span><span class="o">&lt;</span><span class="no">T2</span><span class="o">&gt;,</span> <span class="no">T1</span><span class="o">,</span> <span class="no">R</span><span class="o">&gt;</span> <span class="nf">integrator</span><span class="o">()</span> <span class="o">{</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="k">return</span> <span class="nc">Gatherer</span><span class="o">.</span><span class="na">Integrator</span><span class="o">.</span><span class="na">ofGreedy</span><span class="o">((</span><span class="n">state</span><span class="o">,</span> <span class="n">element</span><span class="o">,</span> <span class="n">downstream</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">downstream</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">zipperFunction</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">state</span><span class="o">.</span><span class="na">next</span><span class="o">()));</span>
      <span class="o">}</span>

      <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This gatherer takes the stream to zip with and a function,
which is applied to pairs of elements of the two streams and returns the zipped result</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="https://download.java.net/java/early_access/jdk22/docs/api/java.base/java/util/stream/Gatherer.html"><code>Gatherer</code></a> has three type parameters: the element type of the stream the gatherer is applied to, a type for keeping track of intermediary state (in our case, that’s just the iterator of the second stream), and the output type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>initializer()</code> returns a supplier of the state tracking type, if needed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>integrator()</code> returns a function which &#34;integrates provided elements, potentially using the provided intermediate state, optionally producing output to the provided <code>Downstream</code>&#34;</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It’s the first time I have been using this API,
so I hope I haven’t done anything too stupid :)
The key part of the gatherer is its <code>Integrator</code> implementation.
This is where for each element of the stream the gatherer is applied to,
we take the corresponding element of the given second stream,
apply the given function, and emit the function’s return value to the next stage in the stream pipeline.</p>
</div>
<div class="paragraph">
<p>This particular implementation stops emitting elements as soon as one of the two streams has been exhausted,
but of course you also could have an implementation with &#34;left join&#34; semantics, or similar.
With some more <a href="https://github.com/gunnarmorling/zip-gatherer/blob/main/src/main/java/dev/morling/demos/Zippers.java">glue code</a> for instantiating this zipping gatherer &#34;builder style&#34;
(you can find the complete source code on GitHub),
this is how it can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
</pre></td><td class="code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">canZipTwoObjectStreams</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">letters</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="s">&#34;d&#34;</span><span class="o">,</span> <span class="s">&#34;e&#34;</span><span class="o">);</span>
  <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="nc">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">letters</span><span class="o">.</span><span class="na">size</span><span class="o">())</span>
      <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="o">);</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">zipped</span> <span class="o">=</span> <span class="n">letters</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
      <span class="o">.</span><span class="na">gather</span><span class="o">(</span><span class="n">zip</span><span class="o">(</span><span class="n">numbers</span><span class="o">).</span><span class="na">with</span><span class="o">((</span><span class="n">letter</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="n">letter</span><span class="o">))</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

  <span class="n">assertThat</span><span class="o">(</span><span class="n">zipped</span><span class="o">).</span><span class="na">containsExactly</span><span class="o">(</span><span class="s">&#34;0-a&#34;</span><span class="o">,</span> <span class="s">&#34;1-b&#34;</span><span class="o">,</span> <span class="s">&#34;2-c&#34;</span><span class="o">,</span> <span class="s">&#34;3-d&#34;</span><span class="o">,</span> <span class="s">&#34;4-e&#34;</span><span class="o">);</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>gather()</code> applies the given gatherer to each element of the stream</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Et voilà, we have a <code>zip()</code> function which can be used with Java Streams,
and short of having a <code>zip()</code> method directly on the <code>Stream</code> interface itself,
the resulting code reads quite nicely.
In order to avoid the boxing of the int stream,
I’ve also built an <code>ObjToIntZipper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">canZipObjectWithIntStream</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">letters</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="s">&#34;d&#34;</span><span class="o">,</span> <span class="s">&#34;e&#34;</span><span class="o">);</span>
  <span class="nc">IntStream</span> <span class="n">numbers</span> <span class="o">=</span> <span class="nc">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">letters</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>

  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">zipped</span> <span class="o">=</span> <span class="n">letters</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
      <span class="o">.</span><span class="na">gather</span><span class="o">(</span><span class="n">zip</span><span class="o">(</span><span class="n">numbers</span><span class="o">).</span><span class="na">with</span><span class="o">((</span><span class="n">letter</span><span class="o">,</span> <span class="n">i</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="n">letter</span><span class="o">))</span>
      <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

  <span class="n">assertThat</span><span class="o">(</span><span class="n">zipped</span><span class="o">).</span><span class="na">containsExactly</span><span class="o">(</span><span class="s">&#34;0-a&#34;</span><span class="o">,</span> <span class="s">&#34;1-b&#34;</span><span class="o">,</span> <span class="s">&#34;2-c&#34;</span><span class="o">,</span> <span class="s">&#34;3-d&#34;</span><span class="o">,</span> <span class="s">&#34;4-e&#34;</span><span class="o">);</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually I am cautious of types with three or more type arguments,
as it easily leads to APIs which are cumbersome to use.
But the Gatherer API actually felt quite intuitive to me after just a little while.</p>
</div>
<div class="paragraph">
<p>The only real downside is that this gatherer cannot be parallelized.
While the API itself allows for the creation of parallel-ready gatherers
(by implementing the optional <a href="https://download.java.net/java/early_access/jdk22/docs/api/java.base/java/util/stream/Gatherer.html#combiner()"><code>combiner()</code></a>) method,
you don’t have a handle to the second stream’s spliterator of a particular subdivision step from within a gatherer implementation.
The only way for doing this is on the spliterator level,
as shown by Jose Paumard in <a href="https://github.com/JosePaumard/more-spliterators/blob/master/src/main/java/org/paumard/spliterators/ZippingSpliterator.java">here</a>.
Note that both input streams must have the same length in order for this to work,
as otherwise you’d end up zipping elements at different positions in the two input streams.</p>
</div>
<div class="paragraph">
<p>You can find the complete source code of the proof-of-concept zipping gatherer in <a href="https://github.com/gunnarmorling/zip-gatherer">this GitHub repository</a>.</p>
</div>
			</div>

			
			
			
			<div class="related-posts">
				<h3>Read Next</h3>
				<ul>
					
					<li><a href="/blog/using-java-13-text-blocks-for-tests/">Using Java 13 Text Blocks (Only) for Your Tests</a> <span class="meta">Jan 13, 2020</span></li>
					
					<li><a href="/blog/building-openjdk-from-source-on-macos/">Building OpenJDK From Source On macOS</a> <span class="meta">Nov 16, 2024</span></li>
					
					<li><a href="/blog/1brc-results-are-in/">1BRC—The Results Are In!</a> <span class="meta">Feb 4, 2024</span></li>
					
				</ul>
			</div>
			
			
		</div>

		<div class="post-footer">
			<div style="display: flex; align-items: center; gap: 1rem;">
				<div class="header-image-container" style="flex-shrink: 0;">
					<img class="footer-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
				</div>
				<p style="margin: 0;">Gunnar Morling is an open-source software engineer in the Java and data streaming space. He currently works as a Technologist for Confluent. In his past role at Decodable he focused on developer outreach and helped them build their stream processing platform based on Apache Flink. Prior to that, he spent ten years at Red Hat, where he led the Debezium project, a platform for change data capture.</p>
			</div>
		</div>

		
		
		<div class="post-discussions">
			<p>Comment below, or join the discussion on
			<a href="https://hn.algolia.com/?query=morling.dev/blog/zipping-gatherer/">Hacker News</a>,
			<a href="https://lobste.rs/search?q=domain:morling.dev+title:%22A%20Zipping%20Gatherer%22&what=stories">Lobsters</a>, and
			<a href="https://www.reddit.com/search/?q=url:morling.dev/blog/zipping-gatherer/">Reddit</a>.
			</p>
		</div>
		<div id="disqus_thread"></div>

<script>
  
  window.addEventListener('load', function() {
    
    setTimeout(function() {
      const commentsContainer = document.getElementById('disqus_thread');
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'gunnarmorling/discussions.morling.dev');
      script.setAttribute('data-repo-id', 'R_kgDOGXzqNQ');
      script.setAttribute('data-category', 'Announcements');
      script.setAttribute('data-category-id', 'DIC_kwDOGXzqNc4B_2Pq');
      script.setAttribute('data-mapping', 'title');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-theme', 'light');
      script.setAttribute('data-lang', 'en');
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;
      commentsContainer.appendChild(script);
    }, 100);
  });
</script>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
