<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>A Taxonomy Of Data Change Events - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="canonical" href="https://www.decodable.co/blog/taxonomy-of-data-change-events" /><meta property="og:url" content="https://www.morling.dev/blog/taxonomy-of-data-change-events/">
  <meta property="og:site_name" content="Gunnar Morling">
  <meta property="og:title" content="A Taxonomy Of Data Change Events">
  <meta property="og:description" content=" This post originally appeared on the Decodable blog. All rights reserved.
Data change events are at the core of Change Data Capture (CDC) solutions such as Debezium. They describe the changes made to …">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="blog">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-03-13T00:00:00Z">
    <meta property="article:modified_time" content="2024-03-13T00:00:00Z">
<meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="A Taxonomy Of Data Change Events">
  <meta name="twitter:description" content=" This post originally appeared on the Decodable blog. All rights reserved.
Data change events are at the core of Change Data Capture (CDC) solutions such as Debezium. They describe the changes made to …">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.min.efd5060e5dbdbc4655a896b01b99c2b759dc5710f5cfda5ed34c2259de325469.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.min.672476d25c0fad0fd490e21222003c6c89ca45b73df6a5634305e06e889c49ad.css" />

	
	<link rel="stylesheet" type="text/css" href="/css/base16.dark.min.c40398d5ec04ac387c57141dc29e820fc4012da1cf2af8235004fc9945fa76a8.css" />
	
	<link rel="stylesheet" type="text/css" href="/css/morlingdev.min.652de9cc60b1cf4122da4f00e0a343c37e1f3ebc307245850071391a72f0b2d7.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>
	<script src="/js/main.min.9ee619eea7f51473f4284ef86c76bdb1b0089e19781ca97275924edf53be5bd4.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">A Taxonomy Of Data Change Events</h1>
				<div class="post-meta-line">
					<span class="meta">Posted at Mar 13, 2024</span>
					
					<span class="post-tags-inline">
						
						<a href="/tags/cdc">cdc</a>
						
						<a href="/tags/debezium">debezium</a>
						
						<a href="/tags/streaming">streaming</a>
						
					</span>
					
				</div>
			</div>

			<div class="post-content">
				<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_full_events">Full Events</a></li>
<li><a href="#_delta_events">Delta Events</a></li>
<li><a href="#_id_only_events">Id-only Events</a></li>
<li><a href="#_change_event_metadata">Change Event Metadata</a></li>
<li><a href="#_comparison">Comparison</a></li>
</ul>
</div>
<div class="paragraph">
<p><em>This post originally appeared on the <a href="https://www.decodable.co/blog/taxonomy-of-data-change-events">Decodable blog</a>. All rights reserved.</em></p>
</div>
<div class="paragraph">
<p>Data change events are at the core of Change Data Capture (CDC) solutions such as <a href="https://debezium.io/">Debezium</a>.
They describe the changes made to a specific record in a database and allow event consumers to take action based on this information, enabling a wide range of <a href="/blog/seven-ways-to-put-cdc-to-work">use cases</a>, such as real-time ETL (by propagating the updated data into downstream data stores such as data warehouses, analytics databases, or fulltext search indexes), microservices data exchange, or audit logging.</p>
</div>
<div class="paragraph">
<p>What is contained within a change event, really?
What kinds of change events exist, and when should you use which?
These are some of the questions I’d like to answer in this post by developing a taxonomy of data change events, discussing three kinds of events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Full events,</strong> which contain the complete state of a changed record,</p>
</li>
<li>
<p><strong>Delta events,</strong> which contain the mutated fields of a record, and</p>
</li>
<li>
<p><strong>Id-only events,</strong> which contain only the id (primary key) of a changed record.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_full_events">Full Events<a class="anchor" href="#_full_events"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s start with the type of event which most users of CDC probably will be familiar with: full, or complete, data change events.
Whenever something changes to a record in a source datastore, such a change event will contain the complete state of that record.
As an example, let’s consider a table <code>customers</code> with columns <code>id</code>, <code>first_name</code>, and <code>last_name</code>, as well as an array-typed column <code>emails</code>.
If a customer record’s <code>first_name</code> value gets updated, while the other fields don’t change, the corresponding change event could look like this, using JSON notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;id&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;first_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Barry&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;last_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Wilson&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;emails&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;barry@example.com&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;bwilson@example.com&#34;</span><span class="p">]</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The change event is fully self-contained.
It describes the complete state of the record at the point in time when it was altered, specifically, the record’s new state after the modification.
Many CDC solutions expose the old and the new state (sometimes referred to as old and new &#34;row image&#34;) of a modified record in their change events, for instance named <code>before</code> and <code>after</code> in the case of Debezium:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;before&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;first_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Billy&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;last_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Wilson&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;emails&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;barry@example.com&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;bwilson@example.com&#34;</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;first_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Barry&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;last_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Wilson&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;emails&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;barry@example.com&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;bwilson@example.com&#34;</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which parts are present in an event, depends on the kind of the data change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an event representing the insertion of a record, only the new row image is present,</p>
</li>
<li>
<p>for an update, both old and new are present, and</p>
</li>
<li>
<p>for a delete event, only the old row image in the after block is present.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whether the old row image actually is present in insert and update events also depends on the configuration of the source database.
Typically, the retention of old row images must be explicitly enabled, as it comes at the cost of additional disk space consumption by the database system.
As an example, in order to emit the old row version in change events with Postgres, the table’s <a href="https://www.postgresql.org/docs/current/sql-altertable.html#SQL-ALTERTABLE-REPLICA-IDENTITY">replica identity</a> must be set to <code>FULL</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Data Change Events and Apache Kafka</em></p>
</div>
<div class="paragraph">
<p>When transferring data change events via partitioned systems such as Apache Kafka, you also need to define a key for your messages. It defines which partition of a change event topic a record will be sent to, ensuring correct ordering of all the records with the same key. For data change events, the key should be derived from the primary key of the represented record in the source data store. That way, all change events for one record will go into one and the same partition of the corresponding change event topic, and consumers will receive them in the exact same order as they occurred in the source database.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_delta_events">Delta Events<a class="anchor" href="#_delta_events"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s look at delta events, or partial change events, next.
They don’t contain the full state of the represented record, but only those columns or fields whose value actually changed as well as the record’s id.
In other words, they describe exactly what has changed compared to the previous version of a record (but nothing more).
For an event representing an insert operation, these are all the record’s attributes, and for an update operation just the mutated ones.
For a delete, only the id will be present.</p>
</div>
<div class="paragraph">
<p>Partial change events can be designed in two different ways.
The first one is to emit any modified attribute in a change event.
Let’s consider the example from the previous section again: the first name of customer 42 gets modified, while last name and email addresses remain unchanged.
Using JSON notation again, and just focusing on the new row image, the corresponding change event could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;id&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;first_name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Barry&#34;</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the chosen serialization format, there are some subtleties around the handling of null values.
In particular, it must allow you to differentiate between an (optional) attribute being set to null and an attribute not being mutated at all.
In JSON, you could distinguish between these two cases by emitting a null value for the field vs.
omitting it from the event payload.</p>
</div>
<div class="paragraph">
<p>A second option for partial data change events is to describe which operations were applied to which attributes specifically.
This can come in handy in particular when dealing with array-valued attributes.
In case of updates, when the change event format contains the full new value, then a small change could cause write amplification, when for instance adding or removing one element to/from an array with twenty entries.
Formats such as <a href="https://jsonpatch.com/">JSON Patch</a> are useful here, as they allow you to describe the changes on a more fine-grained basis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;id&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;patch&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;replace&#34;</span><span class="p">,</span><span class="w"> </span><span class="nl">&#34;path&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/first_name&#34;</span><span class="p">,</span><span class="w"> </span><span class="nl">&#34;value&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Barry&#34;</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;add&#34;</span><span class="p">,</span><span class="w"> </span><span class="nl">&#34;path&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/emails/-&#34;</span><span class="p">,</span><span class="w"> </span><span class="nl">&#34;value&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&#34;berry@example.com&#34;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike full events, delta data change events are not fully self-contained.
When receiving a partial update event, an event consumer must be able to access the previous state of that record in order to be able apply that patch event.
If for instance the consuming system is a SQL database, an <code>UPDATE</code> statement could be issued for updating the affected columns.</p>
</div>
<div class="paragraph">
<p>But what to do when a sink data system does not support partial updates and instead always requires ingesting the complete record when an update has happened?
For cases like this, stateful stream processing, for instance using <a href="https://flink.apache.org/">Apache Flink</a>, can be a useful option.
You’d put this stream processor between your event source and sink, and it would &#34;re-hydrate&#34; full events, this means apply all the incoming partial events one after the other.
To do so, it would utilize an internal state store (such as <a href="https://rocksdb.org/">RocksDB</a>, in case of Flink).
When processing an insert change event for a record, this event would be put into the state store, before emitting it downstream.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/taxonomy-of-data-change-events-1.png" alt="taxonomy of data change events 1"/>
</div>
</div>
<div class="paragraph">
<p>Later on, when processing update events, the stream processor can obtain any attribute values absent from incoming partial events from the state store, thus exposing only ever full events to the downstream event consumers.
While a similar read-before-write approach could also be implemented within sink data stores, doing it in a stream processing pipeline allows to build the re-hydration logic once and then let multiple sinks benefit from it.</p>
</div>
<div class="paragraph">
<p>This technique can also come in handy for situations where a CDC system emits full data change events most of the time, but may emit partial events in certain cases.
One example is Debezium’s connector for Postgres, which <a href="https://debezium.io/blog/2019/10/08/handling-unchanged-postgres-toast-values/">doesn’t emit the value for TOAST columns</a> if their value hasn’t changed.
Stateful stream processing as described above can help to shield consumers from this behavior and always expose complete events to event consumers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_id_only_events">Id-only Events<a class="anchor" href="#_id_only_events"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The last and most basic form of a data change event are id-only events.
They merely describe which record in the source database was affected by a change.
For this purpose, all which the event must contain is the id of the record, for instance, the primary key value of a row in an RDBMS):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Id-only events are used in contexts other than databases and CDC in the strict sense of the word, too.
One example are <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/EventNotifications.html">Amazon S3 event notifications</a>, which you can use for subscribing to changes occurring in an S3 bucket, such as the addition or removal of files.
The id-only event style is used here as would not be practical to expose the entire file state in the corresponding change events.</p>
</div>
<div class="paragraph">
<p>By its very nature, such an id-only event doesn’t tell you what exactly has changed about the represented record.
This makes this event type only useful for quite a narrow range of applications.
For instance, you could use it to <em>invalidate</em> items in a cache, but you couldn’t use it by itself to <em>update</em> at a cache.
Examples for systems working with id-only events include the <a href="https://learn.microsoft.com/en-us/sql/relational-databases/track-changes/about-change-tracking-sql-server?view=sql-server-ver16">Change Tracking</a> feature of Microsoft SQL Server, the <a href="https://www.cockroachlabs.com/docs/v23.2/create-changefeed#options">&#34;key only&#34; mode of CockroachDB</a>, and the <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Streams.html#Streams.Enabling">KEYS_ONLY stream view type in DynamoDB</a>.</p>
</div>
<div class="paragraph">
<p>If you’d like to obtain the entire row, you don’t have any other choice than re-selecting it from the source store.
This could be done by change event consumers themselves, but also by a stream processor which then emits full change events to downstream consumers.
There are a few things to consider when doing this.</p>
</div>
<div class="paragraph">
<p>Most importantly, CDC tools emit change events asynchronously, which means that by the time you run a query for obtaining the complete row state, that row may already have been mutated again.
The query will return the <em>current</em> state of the row, not the one which was valid at the point in time when the change event was triggered originally.
If there are multiple changes to the row in close timely proximity, you may not be able to extract all the intermediary versions of that record.
The following visual illustrates this situation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/taxonomy-of-data-change-events-2.png" alt="taxonomy of data change events 2"/>
</div>
</div>
<div class="paragraph">
<p>At time <code>t1</code>, the record with id 4 is inserted into the <code>customers</code> table, and the corresponding id-only change event is emitted.
Shortly thereafter, the record gets updated at time <code>t2</code>, changing the first name of the customer from &#34;Jazmine&#34; to &#34;Melissa&#34;.
At time <code>t3</code>, the change event for the original insert operation gets processed, issuing a re-select of the record from the database.
As the update already has been committed at this point, the stream processor will propagate the state as of after the update, rather than its original version at insertion time.</p>
</div>
<div class="paragraph">
<p>It may even be possible that the record has been deleted since then, which means that its state cannot be reconstructed by querying for it.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An exception are databases which allow for point-in-time queries, provided the change event contains an unambiguous timestamp or log position describing when the event occurred.
In that case, you could use that information to retrieve the right version, for instance using an <code>AS OF SCN</code> query in Oracle.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Events re-hydrated that way can still be very useful, for instance for propagating data changes into a full-text search engine; in general, you’ll be fine there with just having the latest version of a record in the index, and you don’t need to apply all intermediary updates occurring in a short period of time.
On the other hand, if you’re using CDC for tracking the state transitions of a purchase order and triggering corresponding downstream actions, or for maintaining an audit log, then it is vital to keep track of each and every data change and this technique would not be useful.</p>
</div>
<div class="paragraph">
<p>When implementing a re-select strategy, you should consider retrieving multiple records at once.
So, for example, when receiving change events for ten customer records, instead of executing ten queries for retrieving them one-by-one, you might batch them into one single query, significantly reducing the load on the source database.
Another interesting option is to not only retrieve the specific record itself, but instead to retrieve an entire aggregate of data.
When receiving that id-only event for customer 42, you might for instance run a query which retrieves the customer data as well as their address information and bank account details by joining all the relevant tables.</p>
</div>
<div class="paragraph">
<p>Before comparing the three types of data change events and discussing their individual pros and cons, there’s another concern which deserves attention, and this is event metadata, i.e.
data which describes contextual information for an event.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_change_event_metadata">Change Event Metadata<a class="anchor" href="#_change_event_metadata"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Besides the actual change event payload, representing the data change itself, it often is useful to have additional metadata for an event.
This typically includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of a change (insert, update, delete)</p>
</li>
<li>
<p>Timestamp when the event occurred</p>
</li>
<li>
<p>Name of the originating database, schema, and table</p>
</li>
<li>
<p>Transaction id</p>
</li>
<li>
<p>Position of the event in the source database’s transaction log</p>
</li>
<li>
<p>The query triggering a change</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, here’s an update event as emitted by the <a href="https://debezium.io/documentation/reference/stable/connectors/postgresql">Debezium connector for Postgres</a>, with a range of event metadata in the <code>ts_ms</code>, <code>op</code>, and <code>source</code> fields (you’d find similar metadata in the events emitted by other CDC tools such as <a href="https://maxwells-daemon.io/">Maxwell’s Daemon</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;before&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1004</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;first_name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Billy&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;last_name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Wilson&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;email&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;bwilson@example.com&#34;</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1004</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;first_name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Barray&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;last_name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Wilson&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;email&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;bwilson@example.com&#34;</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">&#34;source&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;version&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.5.0.Final&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;connector&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;postgresql&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;dbserver1&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705663711187</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;snapshot&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;false&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;db&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;postgres&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;sequence&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;[</span><span class="se">\&#34;</span><span class="s2">34471328</span><span class="se">\&#34;</span><span class="s2">,</span><span class="se">\&#34;</span><span class="s2">34494376</span><span class="se">\&#34;</span><span class="s2">]&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;schema&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;table&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;customers&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;txId&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">773</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;lsn&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">34494376</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;xmin&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;u&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705663711220</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Change event metadata allows for a number of interesting applications on the consumer side.
For instance, the information about which transaction an event originated from can be used for propagating the same transactional semantics to the sink of a data pipeline too: instead of ingesting incoming events one by one, you could buffer the events for one transaction and apply them all at once in a transaction to the sink data store.
That way, queries against the sink data store are subject to the same isolation guarantees as with the source database.
Another interesting metadata field is the <code>sequence</code> attribute emitted by Debezium’s Postgres connector, which can be used by clients for deduplication in data pipelines with at-least once semantics.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comparison">Comparison<a class="anchor" href="#_comparison"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Having explored the three kinds of data change event, which one should you use?
As so often, there is not an universal answer to that.
Each of the types has its respective advantages and disadvantages and you’ll need to make an informed decision based on your specific context.</p>
</div>
<div class="paragraph">
<p>Complete data change events tend to be the easiest to handle for consuming systems.
The incoming event can be simply written to a sink data store using &#34;upsert&#34; semantics, overwriting whatever version there might have been there before.
When propagating change events via distributed log systems such as Apache Kafka, a topic with full change events can be compacted.
As each event is fully self-contained, it is sufficient to keep the latest change event per record in the log and it is still possible to propagate the complete state of the data set to consumers (and if your change events contain new and old row images, you’d even have the last two versions per recorded even in a compacted change event topic).
It is also easily possible to bootstrap new event consumers solely from the state in the distributed log.
The downside of full events is their larger size.</p>
</div>
<div class="paragraph">
<p>Id-only events are much more compact, as they don’t convey any information other than the id of changed records.
In order to retrieve the actual event state, you’ll need to query the source system again which comes at the risk that you may miss any intermediary updates to a record occurring between the point in time when a change event was triggered and when you process it.
As such, their use is rather limited, but they can come in handy for some use cases such as cache invalidation.</p>
</div>
<div class="paragraph">
<p>Delta events can be an interesting middle ground.
Conveying only the modified fields of a changed record, they consume less space than a full event.
But in order to propagate them into a sink datastore, it must have the capability to do partial updates, i.e.
the ability to just update a subset of a record’s fields, rather than having to rewrite the entire record.
If that is not an option, you can use a stateful stream processing pipeline between the CDC tool and the sink datastore to recreate full events.
A change event topic with delta events cannot be compacted, as consumers otherwise may miss update events they need to recreate the represented source record.
As a consequence, when there is a high volume of updates, a topic with partial events may even consume more space than a (compacted) topic with full events.</p>
</div>
<div class="paragraph">
<p>The following table provides an overview of the three change event types and their specific properties:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/taxonomy-of-data-change-events-3.png" alt="taxonomy of data change events 3"/>
</div>
</div>
<div class="paragraph">
<p>As the comparison shows, each of the different event types has its individual characteristics.
Which one to use depends not only on the capabilities of the systems you’re working with, but also—as always—on the specific use case and its requirements.</p>
</div>
<div class="paragraph">
<p>Real-time stream processing with solutions such as Apache Flink, is a powerful companion to CDC tools like Debezium, allowing you to transform and amend change event streams if and when needed.
Examples include the expansion of id-only change events—by selecting the entire row state from the source database—as well as the hydration of full events from delta change events by using a state store.
But you also can employ stream processing to great effect for other CDC-related tasks, for instance for establishing stable data contracts for your change events streams, as I’ve discussed in <a href="/blog/change-data-capture-breaks-encapsulation-does-it-though">another blog post</a> not too long ago.</p>
</div>
</div>
</div>
			</div>

			
			
			
			<div class="related-posts">
				<h3>Read Next</h3>
				<ul>
					
					<li><a href="/blog/change-data-capture-breaks-encapsulation-does-it-though/">&#34;Change Data Capture Breaks Encapsulation&#34;. Does it, though?</a> <span class="meta">Nov 21, 2023</span></li>
					
					<li><a href="/blog/cdc-use-cases/">CDC Use Cases: 7 Ways to Put CDC to Work</a> <span class="meta">Nov 2, 2023</span></li>
					
					<li><a href="/blog/failover-replication-slots-with-postgres-17/">Failover Replication Slots with Postgres 17</a> <span class="meta">Dec 3, 2024</span></li>
					
				</ul>
			</div>
			
			
		</div>

		<div class="post-footer">
			<div style="display: flex; align-items: center; gap: 1rem;">
				<div class="header-image-container" style="flex-shrink: 0;">
					<img class="footer-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
				</div>
				<p style="margin: 0;">Gunnar Morling is an open-source software engineer in the Java and data streaming space. He currently works as a Technologist for Confluent. In his past role at Decodable he focused on developer outreach and helped them build their stream processing platform based on Apache Flink. Prior to that, he spent ten years at Red Hat, where he led the Debezium project, a platform for change data capture.</p>
			</div>
		</div>

		
		
		<div class="post-discussions">
			<p>Comment below, or join the discussion on
			<a href="https://hn.algolia.com/?query=morling.dev/blog/taxonomy-of-data-change-events/">Hacker News</a>,
			<a href="https://lobste.rs/search?q=domain:morling.dev+title:%22A%20Taxonomy%20Of%20Data%20Change%20Events%22&what=stories">Lobsters</a>, and
			<a href="https://www.reddit.com/search/?q=url:morling.dev/blog/taxonomy-of-data-change-events/">Reddit</a>.
			</p>
		</div>
		<div id="disqus_thread"></div>

<script>
  
  window.addEventListener('load', function() {
    
    setTimeout(function() {
      const commentsContainer = document.getElementById('disqus_thread');
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'gunnarmorling/discussions.morling.dev');
      script.setAttribute('data-repo-id', 'R_kgDOGXzqNQ');
      script.setAttribute('data-category', 'Announcements');
      script.setAttribute('data-category-id', 'DIC_kwDOGXzqNc4B_2Pq');
      script.setAttribute('data-mapping', 'title');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-theme', 'light');
      script.setAttribute('data-lang', 'en');
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;
      commentsContainer.appendChild(script);
    }, 100);
  });
</script>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
