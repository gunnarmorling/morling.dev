<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>ByteBuffer and the Dreaded NoSuchMethodError - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta property="og:url" content="https://www.morling.dev/blog/bytebuffer-and-the-dreaded-nosuchmethoderror/">
  <meta property="og:site_name" content="Gunnar Morling">
  <meta property="og:title" content="ByteBuffer and the Dreaded NoSuchMethodError">
  <meta property="og:description" content=" The other day, a user in the Debezium community reported an interesting issue; They were using Debezium with Java 1.8 and got an odd NoSuchMethodError:
">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="blog">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2020-12-21T17:45:00&#43;01:00">
    <meta property="article:modified_time" content="2020-12-21T17:45:00&#43;01:00">
<meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="ByteBuffer and the Dreaded NoSuchMethodError">
  <meta name="twitter:description" content=" The other day, a user in the Debezium community reported an interesting issue; They were using Debezium with Java 1.8 and got an odd NoSuchMethodError:
">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/normalize.min.efd5060e5dbdbc4655a896b01b99c2b759dc5710f5cfda5ed34c2259de325469.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/css/main.min.672476d25c0fad0fd490e21222003c6c89ca45b73df6a5634305e06e889c49ad.css" />

	
	<link rel="stylesheet" type="text/css" href="/css/base16.dark.min.c40398d5ec04ac387c57141dc29e820fc4012da1cf2af8235004fc9945fa76a8.css" />
	
	<link rel="stylesheet" type="text/css" href="/css/morlingdev.min.652de9cc60b1cf4122da4f00e0a343c37e1f3ebc307245850071391a72f0b2d7.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>
	<script src="/js/main.min.9ee619eea7f51473f4284ef86c76bdb1b0089e19781ca97275924edf53be5bd4.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">ByteBuffer and the Dreaded NoSuchMethodError</h1>
				<div class="post-meta-line">
					<span class="meta">Posted at Dec 21, 2020</span>
					
					<span class="post-tags-inline">
						
						<a href="/tags/java">java</a>
						
						<a href="/tags/compatibility">compatibility</a>
						
						<a href="/tags/troubleshooting">troubleshooting</a>
						
					</span>
					
				</div>
			</div>

			<div class="post-content">
				<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_how_to_prevent_this_situation">How to Prevent This Situation?</a></li>
</ul>
</div>
<div class="paragraph">
<p>The other day, a user in the <a href="https://debezium.io/">Debezium</a> community reported an interesting issue;
They were using Debezium with Java 1.8 and got an odd <code>NoSuchMethodError</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>java.lang.NoSuchMethodError: java.nio.ByteBuffer.position<span class="o">(</span>I<span class="o">)</span>Ljava/nio/ByteBuffer<span class="p">;</span>
  at io.debezium.connector.postgresql.connection.Lsn.valueOf<span class="o">(</span>Lsn.java:86<span class="o">)</span>
  at io.debezium.connector.postgresql.connection.PostgresConnection.tryParseLsn<span class="o">(</span>PostgresConnection.java:270<span class="o">)</span>
  at io.debezium.connector.postgresql.connection.PostgresConnection.parseConfirmedFlushLsn<span class="o">(</span>PostgresConnection.java:235<span class="o">)</span>
  ...
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>NoSuchMethodError</code> typically is an indication for a mismatch of the Java version used to compile some code, and the Java version used for running it:
some method existed at compile time, but it’s not available at runtime.</p>
</div>
<div class="paragraph">
<p>Now indeed we use JDK 11 for building the Debezium code base, while targeting Java 1.8 as the minimal required version at runtime.
But there <em>is</em>  a method <a href="https://docs.oracle.com/javase/8/docs/api/java/nio/Buffer.html#position-int-"><code>position(int)</code></a> defined on the <code>Buffer</code> class
(which <code>ByteBuffer</code> extends) also in Java 1.8.
And as a matter of fact, the Debezium code compiles just fine with that version, too.
So why would the user run into this error then?</p>
</div>
<div class="paragraph">
<p>To understand what’s going on, let’s create a very simple class for reproducing the issue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">java.nio.ByteBuffer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ByteBufferTest</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">ByteBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="nc">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="o">{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">});</span>
    <span class="n">buffer</span><span class="o">.</span><span class="na">position</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">buffer</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Why does this not work with Java 1.8 when compiled with JDK 9 or newer?</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Compile this with a current JDK:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nv">$ </span>javac <span class="nt">--source</span> 1.8 <span class="nt">--target</span> 1.8 ByteBufferTest.java
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And sure enough, the <code>NoSuchMethodError</code> shows up when running this with Java 1.8:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nv">$ </span>java ByteBufferTest

Exception <span class="k">in </span>thread <span class="s2">&#34;main&#34;</span> java.lang.NoSuchMethodError: java.nio.ByteBuffer.position<span class="o">(</span>I<span class="o">)</span>Ljava/nio/ByteBuffer<span class="p">;</span>
	at ByteBufferTest.main<span class="o">(</span>ByteBufferTest.java:6<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas, when using 1.8 to compile <em>and</em> run this code, it just works fine.
Now, if we take a closer look at the error message again, the missing method is defined as <code>ByteBuffer position(int)</code>.
I.e. for an invoked method like <code>position()</code>, not only its name, parameter type(s), and the name of the declaring class are part of the byte code for that invocation, but also the method’s return type.
A look at the byte code of the class using <em>javap</em> confirms that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="nv">$ </span>javap <span class="nt">-p</span> <span class="nt">-c</span> <span class="nt">-s</span> <span class="nt">-v</span> <span class="nt">-l</span> <span class="nt">-constants</span> ByteBufferTest

...
public static void main<span class="o">(</span>java.lang.String...<span class="o">)</span><span class="p">;</span>
  descriptor: <span class="o">([</span>Ljava/lang/String<span class="p">;</span><span class="o">)</span>V
  flags: ACC_PUBLIC, ACC_STATIC, ACC_VARARGS
  Code:
    <span class="nv">stack</span><span class="o">=</span>4, <span class="nv">locals</span><span class="o">=</span>2, <span class="nv">args_size</span><span class="o">=</span>1
...
      19: aload_1
      20: iconst_1
      21: invokevirtual <span class="c">#13 // Method java/nio/ByteBuffer.position:(I)Ljava/nio/ByteBuffer;</span>
...
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And this points us to the right direction;
In Java 1.8, indeed there is no such method, only the <code>position()</code> method on <code>Buffer</code>,
which, of course, returns <code>Buffer</code> and not <code>ByteBuffer</code>.
Whereas since Java 9, this method (and several others) <a href="https://docs.oracle.com/javase/9/docs/api/java/nio/ByteBuffer.html#position-int-">is overridden</a> in <code>ByteBuffer</code> — leveraging Java’s support for co-variant return types — to return <code>ByteBuffer</code>.
The Java compiler will now select that method, <code>ByteBuffer position(int)</code>, and record that as the invoked method signature in the byte code of the caller class.</p>
</div>
<div class="paragraph">
<p>This is per-se a nice usability improvement, as it allows to invoke further <code>ByteBuffer</code> methods on the return value, instead of just those methods declared by <code>Buffer</code>.
But as we’ve seen, it comes with this little surprise when compiling code on JDK 9 or newer,
while trying to keep compatibility with older Java versions.
And as it turns out, we were not the first or only ones to encounter this issue.
Quite a few open-source projects ran into this, e.g. <a href="https://github.com/eclipse/jetty.project/issues/3244">Eclipse Jetty</a>, <a href="https://github.com/streamnative/pulsar/issues/1645">Apache Pulsar</a>, <a href="https://github.com/eclipse-vertx/vertx-sql-client/issues/736">Eclipse Vert.x</a>, <a href="https://github.com/apache/thrift/pull/2231">Apache Thrift</a>, the <a href="https://github.com/yugabyte/yugabyte-db/issues/6712">Yugabyte DB client</a>, and a few others.</p>
</div>
<div class="sect1">
<h2 id="_how_to_prevent_this_situation">How to Prevent This Situation?<a class="anchor" href="#_how_to_prevent_this_situation"></a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>So what can you do in order to prevent this issue from happening?
One first idea could be to enforce selection of the right method by casting to <code>Buffer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="o">((</span><span class="n">java</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">Buffer</span><span class="o">)</span> <span class="n">buffer</span><span class="o">).</span><span class="na">position</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>But while this produces the desired byte code indeed,
it isn’t exactly the best way for doing so.
You’d have to remember to do so for every invocation of any of the affected <code>ByteBuffer</code> methods,
and the seemling unneeded cast might be an easy target for some &#34;clean-up&#34; by unsuspecting co-workers on our team.</p>
</div>
<div class="paragraph">
<p>Luckily, there’s a much better way, and this is to rely on the Java compiler’s <code>--release</code> parameter,
which was introduced via <a href="http://openjdk.java.net/jeps/247">JEP 247</a> (&#34;Compile for Older Platform Versions&#34;),
added to the platform also in JDK 9.
In contrast to the more widely known pair of <code>--source</code> and <code>--target</code>,
the <code>--release</code> switch will ensure that only byte code is produced which actually will be useable with the specified Java version.
For this purpose, the JDK contains the signature data for all supported Java versions
(stored in the <em>$JAVA_HOME/lib/ct.sym</em> file).</p>
</div>
<div class="paragraph">
<p>So all that’s needed really is compiling the code with <code>--release=8</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nv">$ </span>javac <span class="nt">--release</span><span class="o">=</span>8 ByteBufferTest.java
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Examine the bytecode using <em>javap</em> again, and now the expected signature is in place:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>21: invokevirtual <span class="c">#13 // Method java/nio/ByteBuffer.position:(I)Ljava/nio/Buffer;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>When run on Java 1.8, this virtual method call will be resolved to <code>Buffer#position(int)</code> at runtime,
whereas on Java 9 and later, it’d resolve to the <a href="https://www.artima.com/weblogs/viewpost.jsp?thread=354443">bridge method</a> inserted by the compiler into the class file of <code>ByteBuffer</code> due to the co-variant return type, which itself calls the overriding <code>ByteBuffer#position(int)</code> method.</p>
</div>
<div class="paragraph">
<p>Now let’s see what happens if we actually try to make use of the overriding method version in <code>ByteBuffer</code> by re-assigning the result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="o">...</span>
<span class="nc">ByteBuffer</span> <span class="n">buffer</span> <span class="o">=</span> <span class="nc">ByteBuffer</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="o">{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span> <span class="o">});</span>
<span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="o">.</span><span class="na">position</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Et voilà, this gets rejected by the compiler when targeting Java 1.8,
as the return type of the JDK 1.8 method <code>Buffer#position(int)</code> cannot be assigned to <code>ByteBuffer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nv">$ </span>javac <span class="nt">--release</span><span class="o">=</span>8 ByteBufferTest.java

ByteBufferTest.java:6: error: incompatible types: Buffer cannot be converted to ByteBuffer
        buffer <span class="o">=</span> buffer.position<span class="o">(</span>1<span class="o">)</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>To cut a long story short, we — and many other projects — should have used the <code>--release</code> switch instead of <code>--source</code>/<code>--target</code>, and the user would not have had that issue.
In order to achieve the same in your Maven-based build,
just specify the following property in your <em>pom.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>...
<span class="nt">&lt;properties&gt;</span>
  <span class="nt">&lt;maven.compiler.release&gt;</span>8<span class="nt">&lt;/maven.compiler.release&gt;</span>
<span class="nt">&lt;/properties&gt;</span>
...
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that theoretically you could achieve the same effect also when using <code>--source</code> and <code>--target</code>;
by means of the <code>--boot-class-path</code> option, you could advise the compiler to use a specific set of bootstrap class files instead of those from the JDK used for compilation.
But that’d be quite a bit more cumbersome as it requires you to actually provide the classes of the targeted Java version,
whereas <code>--release</code> will make use of the signature data coming with the currently used JDK itself.</p>
</div>
</div>
</div>
			</div>

			
			
			
			<div class="related-posts">
				<h3>Read Next</h3>
				<ul>
					
					<li><a href="/blog/finding-java-thread-leaks-with-jdk-flight-recorder-and-bit-of-sql/">Finding Java Thread Leaks With JDK Flight Recorder and a Bit Of SQL</a> <span class="meta">Feb 28, 2023</span></li>
					
					<li><a href="/blog/refining-return-type-java-methods-without-breaking-backwards-compatibility/">Refining The Return Type Of Java Methods Without Breaking Backwards-Compatibility</a> <span class="meta">Nov 22, 2021</span></li>
					
					<li><a href="/blog/the-anatomy-of-ct-sym-how-javac-ensures-backwards-compatibility/">The Anatomy of ct.sym — How javac Ensures Backwards Compatibility</a> <span class="meta">Apr 26, 2021</span></li>
					
				</ul>
			</div>
			
			
		</div>

		<div class="post-footer">
			<div style="display: flex; align-items: center; gap: 1rem;">
				<div class="header-image-container" style="flex-shrink: 0;">
					<img class="footer-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
				</div>
				<p style="margin: 0;">Gunnar Morling is an open-source software engineer in the Java and data streaming space. He currently works as a Technologist for Confluent. In his past role at Decodable he focused on developer outreach and helped them build their stream processing platform based on Apache Flink. Prior to that, he spent ten years at Red Hat, where he led the Debezium project, a platform for change data capture.</p>
			</div>
		</div>

		
		
		<div class="post-discussions">
			<p>Comment below, or join the discussion on
			<a href="https://hn.algolia.com/?query=morling.dev/blog/bytebuffer-and-the-dreaded-nosuchmethoderror/">Hacker News</a>,
			<a href="https://lobste.rs/search?q=domain:morling.dev+title:%22ByteBuffer%20and%20the%20Dreaded%20NoSuchMethodError%22&what=stories">Lobsters</a>, and
			<a href="https://www.reddit.com/search/?q=url:morling.dev/blog/bytebuffer-and-the-dreaded-nosuchmethoderror/">Reddit</a>.
			</p>
		</div>
		<div id="disqus_thread"></div>

<script>
  
  window.addEventListener('load', function() {
    
    setTimeout(function() {
      const commentsContainer = document.getElementById('disqus_thread');
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'gunnarmorling/discussions.morling.dev');
      script.setAttribute('data-repo-id', 'R_kgDOGXzqNQ');
      script.setAttribute('data-category', 'Announcements');
      script.setAttribute('data-category-id', 'DIC_kwDOGXzqNc4B_2Pq');
      script.setAttribute('data-mapping', 'title');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-theme', 'light');
      script.setAttribute('data-lang', 'en');
      script.setAttribute('crossorigin', 'anonymous');
      script.async = true;
      commentsContainer.appendChild(script);
    }, 100);
  });
</script>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
