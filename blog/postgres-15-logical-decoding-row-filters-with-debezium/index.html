<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Postgres 15: Logical Decoding Row Filters With Debezium - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:url" content="https://www.morling.dev/blog/postgres-15-logical-decoding-row-filters-with-debezium/">
  <meta property="og:site_name" content="Gunnar Morling">
  <meta property="og:title" content="Postgres 15: Logical Decoding Row Filters With Debezium">
  <meta property="og:description" content=" This post originally appeared on the Decodable blog.
Since logical decoding was added to Postgres in version 9.4, this powerful feature for capturing changes from the write-ahead log of the database …">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="blog">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2022-12-15T00:00:00&#43;01:00">
    <meta property="article:modified_time" content="2022-12-15T00:00:00&#43;01:00">
<meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Postgres 15: Logical Decoding Row Filters With Debezium">
  <meta name="twitter:description" content=" This post originally appeared on the Decodable blog.
Since logical decoding was added to Postgres in version 9.4, this powerful feature for capturing changes from the write-ahead log of the database …">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
 
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/main.css" />

	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/base16.dark.css" />
	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/morlingdev.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>

	<script src="https://www.morling.dev//js/main.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">Postgres 15: Logical Decoding Row Filters With Debezium</h1>
				<div class="meta">Posted at Dec 15, 2022</div>
			</div>

			<div class="post-content">
				<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_using_logical_decoding_row_filters_with_debezium">Using Logical Decoding Row Filters With Debezium</a></li>
<li><a href="#_observing_filtered_change_events">Observing Filtered Change Events</a></li>
<li><a href="#_wrap_up">Wrap-Up</a></li>
</ul>
</div>
<div class="paragraph">
<p><em>This post <a href="https://www.decodable.co/blog/postgres-15-logical-decoding-row-filters-with-debezium">originally appeared</a> on the Decodable blog.</em></p>
</div>
<div class="paragraph">
<p>Since <a href="https://www.postgresql.org/docs/current/logicaldecoding-explanation.html">logical decoding</a> was added to Postgres in version 9.4, this powerful feature for capturing changes from the write-ahead log of the database has been continuously improved. <a href="https://www.postgresql.org/about/news/postgresql-15-released-2526/">Postgres 15</a>, released in October this year, added support for fine-grained control over which columns (by means of column lists) and rows (via row filters) should be exported from captured tables. This means, in relational terminology, projections and filters are now natively supported by Postgres change event publications.</p>
</div>
<div class="paragraph">
<p>Reasons for specifically configuring which columns and rows should be contained in a change data stream are manifold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Excluding large columns (say, a binary column with image data) can significantly reduce the size of change events and thus the required network bandwidth</p>
</li>
<li>
<p>Excluding columns or rows with sensitive data can be necessary in order to satisfy privacy requirements, when for instance Personally Identifiable Information (PII) shouldn’t be exposed to external systems</p>
</li>
<li>
<p>Filtering published rows by tenant id can be useful for setting up tenant-specific change streams in a multi-tenant architecture</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before the advent of Postgres-native column lists and row filters, users of <a href="https://debezium.io/">Debezium</a>—​a popular open-source platform for change data capture (CDC), which also is used by several Decodable CDC connectors—​would typically have implemented these kinds of use cases via a combination of configuration options and single message transformations (SMTs).</p>
</div>
<div class="paragraph">
<p>Projections are supported in Debezium via the <a href="https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-property-column-include-list">column.include.list</a> and <a href="https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-property-column-exclude-list">column.exclude.list</a> options. These configuration options are applied client-side, i.e. within the Debezium connector, which makes them less efficient to server-side column lists, potentially causing large amounts of data to be streamed to Debezium, only to be discarded there.</p>
</div>
<div class="paragraph">
<p>Filters are a bit more involved: while there is built-in support for filtering the contents of initial and ad-hoc <a href="https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-ad-hoc-snapshots">incremental snapshots</a>, filtering change events emitted from the WAL requires a custom SMT. Pushing this logic into the logical replication mechanism of the database itself makes a lot of sense from a usability and efficiency perspective.</p>
</div>
<div class="paragraph">
<p>So let’s see how Postgres 15 row filters can be used together with Debezium. Initially, I meant to demonstrate the usage of column lists, too. But in the course of exploring that feature, I <a href="https://www.postgresql.org/message-id/flat/CADGJaX9kiRZ-OH0EpWF5Fkyh1ZZYofoNRCrhapBfdk02tj5EKg%40mail.gmail.com">discovered a bug</a> in Postgres which causes incorrect events to be emitted for UPDATE and DELETE statements when column lists are present. So this will have to wait for another time. The Postgres community took care of this super fast: a bug fix has already been applied, so that column lists should work as expected in the next Postgres release.</p>
</div>
<div class="sect1">
<h2 id="_using_logical_decoding_row_filters_with_debezium">Using Logical Decoding Row Filters With Debezium</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To follow along, check out the <a href="https://github.com/gunnarmorling/postgres-publication-filtering">postgres-publication-filtering</a> demo project from GitHub. It contains a Docker Compose file for running Postgres as well as Apache Kafka and Kafka Connect with Debezium:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre>git clone git@github.com:gunnarmorling/postgres-publication-filtering.git
<span class="nb">cd </span>postgres-publication-filtering
docker-compose up <span class="nt">--build</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>That Postgres example container image contains a table <code>products</code> with the following schema:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/postgres15-products-table-schema.webp" alt="Products table schema"/>
</div>
</div>
<div class="paragraph">
<p>Let’s set up a change event stream for that table which only contains events if the quantity of the given product item is below 10. We could then for instance envision a microservice which subscribes to that stream and places backfill orders with our suppliers for those products.</p>
</div>
<div class="paragraph">
<p>Row filters are configured via Postgres <a href="https://www.postgresql.org/docs/current/logical-replication-publication.html">publications</a>, as used with the <a href="https://www.postgresql.org/docs/current/protocol-logicalrep-message-formats.html">pgoutput</a> logical decoding plug-in. As Debezium can only create publications with the default settings (at least for now), you need to manually create a custom publication with the required configurations and have Debezium make use of it. To do so, launch a Postgres session via pgcli:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>docker run <span class="nt">--tty</span> <span class="nt">--rm</span> <span class="nt">-i</span> <span class="se">\</span>
   <span class="nt">--network</span> postgres-publication-filtering_default <span class="se">\</span>
   quay.io/debezium/tooling:1.2 <span class="se">\</span>
   bash <span class="nt">-c</span> <span class="s1">&#39;pgcli postgresql://postgresuser:postgrespw@postgres:5432/postgresdb&#39;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create a publication like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="k">SET</span> <span class="n">search_path</span> <span class="k">TO</span> <span class="n">inventory</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="n">PUBLICATION</span> <span class="n">inventory_publication</span> <span class="k">FOR</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">quantity</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As of Postgres 15, the <code>CREATE PUBLICATION</code> statement allows you to narrow down the events to be emitted for a given table via a custom <code>WHERE</code> clause. A few conditions apply to that clause (see <a href="http://amitkapila16.blogspot.com/2022/11/logical-replication-improvements-in.html">this post</a> for more information), most importantly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the publication publishes UPDATE or DELETE events, only columns which are part of the table’s <a href="https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-replica-identity">replica identity</a> may be referenced</p>
</li>
<li>
<p>Only simple expressions are allowed, for example not referring to user-defined functions or types, system columns etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That’s all we need to do on the Postgres side. Now let’s take a look at the required Debezium configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nl">&#34;plugin.name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;pgoutput&#34;</span><span class="err">,</span><span class="w">
</span><span class="nl">&#34;publication.autocreate.mode&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;disabled&#34;</span><span class="err">,</span><span class="w">
</span><span class="nl">&#34;publication.name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory_publication&#34;</span><span class="err">,</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the Postgres publication only is used when Debezium retrieves change events via logical decoding from the WAL, you also need to customize the SELECT statement used for the <code>products</code> table when snapshotting the table. Otherwise, you’d get snapshot events for all the rows of that table, no matter what their quantity is. This can be done via the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nl">&#34;snapshot.select.statement.overrides&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory.products:WHERE quantity &lt; 10&#34;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Altogether, the connector configuration looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory-connector&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;config&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;connector.class&#34;</span><span class="p">:</span><span class="s2">&#34;io.debezium.connector.postgresql.PostgresConnector&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;tasks.max&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;database.hostname&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;postgres&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;database.port&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;5432&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;database.user&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;postgresuser&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;database.password&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;postgrespw&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;database.dbname&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;postgresdb&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;topic.prefix&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;dbserver1&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;schema.include.list&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;table.include.list&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory.products,inventory.customers,inventory.test&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;plugin.name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;pgoutput&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;publication.autocreate.mode&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;disabled&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;publication.name&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory_publication&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;snapshot.select.statement.overrides&#34;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;inventory.products&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;snapshot.select.statement.overrides.inventory.products&#34;</span><span class="w"> </span><span class="p">:</span><span class="w">
        </span><span class="s2">&#34;SELECT * FROM inventory.products WHERE quantity &lt; 10&#34;</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now register a connector instance with this configuration. If you have kcctl installed (which I highly recommend), that’s as simple as that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>kcctl apply <span class="nt">-f</span> inventory-connector.json
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, use curl to post the configuration directly to Kafka Connect’s REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>curl <span class="nt">-i</span> <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">&#34;Accept:application/json&#34;</span> <span class="nt">-H</span>  <span class="s2">&#34;Content-Type:application/json&#34;</span> <span class="se">\</span>
    http://localhost:8083/connectors/ <span class="nt">-d</span> @inventory-connector.json
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observing_filtered_change_events">Observing Filtered Change Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Return to your Postgres session and display the contents of the <code>products</code> table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="n">postgresdb</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">quantity</span> <span class="k">from</span> <span class="n">inventory</span><span class="p">.</span><span class="n">products</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------+--------------------+------------+</span>
<span class="o">|</span> <span class="n">id</span>   <span class="o">|</span> <span class="n">name</span>               <span class="o">|</span> <span class="n">quantity</span>   <span class="o">|</span>
<span class="o">|</span><span class="c1">------+--------------------+------------|</span>
<span class="o">|</span> <span class="mi">101</span>  <span class="o">|</span> <span class="n">scooter</span>            <span class="o">|</span> <span class="mi">5</span>          <span class="o">|</span>
<span class="o">|</span> <span class="mi">102</span>  <span class="o">|</span> <span class="n">car</span> <span class="n">battery</span>        <span class="o">|</span> <span class="mi">10</span>         <span class="o">|</span>
<span class="o">|</span> <span class="mi">103</span>  <span class="o">|</span> <span class="mi">12</span><span class="o">-</span><span class="n">pack</span> <span class="n">drill</span> <span class="n">bits</span> <span class="o">|</span> <span class="mi">44</span>         <span class="o">|</span>
<span class="o">|</span> <span class="mi">104</span>  <span class="o">|</span> <span class="n">hammer</span>             <span class="o">|</span> <span class="mi">12</span>         <span class="o">|</span>
<span class="o">|</span> <span class="mi">105</span>  <span class="o">|</span> <span class="n">hammer</span>             <span class="o">|</span> <span class="mi">42</span>         <span class="o">|</span>
<span class="o">|</span> <span class="mi">106</span>  <span class="o">|</span> <span class="n">hammer</span>             <span class="o">|</span> <span class="mi">37</span>         <span class="o">|</span>
<span class="o">|</span> <span class="mi">107</span>  <span class="o">|</span> <span class="n">rocks</span>              <span class="o">|</span> <span class="mi">9</span>          <span class="o">|</span>
<span class="o">|</span> <span class="mi">108</span>  <span class="o">|</span> <span class="n">jacket</span>             <span class="o">|</span> <span class="mi">19</span>         <span class="o">|</span>
<span class="o">|</span> <span class="mi">109</span>  <span class="o">|</span> <span class="n">spare</span> <span class="n">tire</span>         <span class="o">|</span> <span class="mi">28</span>         <span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------------------+------------+</span>
<span class="k">SELECT</span> <span class="mi">9</span>
<span class="nb">Time</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">050</span><span class="n">s</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Out of those nine product items, only those with a quantity of less than ten show up as snapshot events in the corresponding Kafka topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>docker run <span class="nt">--tty</span> <span class="nt">--rm</span> <span class="se">\</span>
  <span class="nt">--network</span> postgres-publication-filtering_default <span class="se">\</span>
  quay.io/debezium/tooling:1.2 <span class="se">\</span>
  kafkacat <span class="nt">-b</span> kafka:9092 <span class="nt">-C</span> <span class="nt">-o</span> beginning <span class="nt">-q</span> <span class="se">\</span>
  <span class="nt">-t</span> dbserver1.inventory.products | jq <span class="s1">&#39;.payload | { op, ts_ms, after }&#39;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;r&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1669375471236</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;scooter&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;description&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Small 2-wheel scooter&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;weight&#34;</span><span class="p">:</span><span class="w"> </span><span class="mf">3.14</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;quantity&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;r&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1669375471238</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">107</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;rocks&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;description&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;box of assorted rocks&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;weight&#34;</span><span class="p">:</span><span class="w"> </span><span class="mf">5.3</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;quantity&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let’s do some data changes and observe the resulting change events, as retrieved from the database via logical decoding. First, insert a few records into the table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">products</span>
<span class="k">VALUES</span>
  <span class="p">(</span><span class="k">DEFAULT</span><span class="p">,</span> <span class="s1">&#39;deck chair&#39;</span><span class="p">,</span> <span class="s1">&#39;A cozy wooden deck chair&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
  <span class="p">(</span><span class="k">DEFAULT</span><span class="p">,</span> <span class="s1">&#39;paint&#39;</span><span class="p">,</span> <span class="s1">&#39;A bucket of white paint&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
  <span class="p">(</span><span class="k">DEFAULT</span><span class="p">,</span> <span class="s1">&#39;lamp&#39;</span><span class="p">,</span> <span class="s1">&#39;A green library style lamp&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nothing too exciting is happening in the Kafka topic: as you would expect, only events for the deck chair and the lamp products show up in Kafka, but not for the paint item, as its quantity is larger than 10. Things get a bit more interesting when doing some updates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="k">UPDATE</span> <span class="n">products</span> <span class="k">SET</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">6</span> <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;deck chair&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">products</span> <span class="k">SET</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">14</span> <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;paint&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">products</span> <span class="k">SET</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">9</span> <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;paint&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">products</span> <span class="k">SET</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">11</span> <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;lamp&#39;</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following three events are emitted to Kafka for those:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;u&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1669382021989</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;before&#34;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">110</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;deck chair&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;description&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;A cozy wooden deck chair&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;weight&#34;</span><span class="p">:</span><span class="w"> </span><span class="mf">15.7</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;quantity&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w">
   </span><span class="p">},</span><span class="w">
  </span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w">
   </span><span class="p">{</span><span class="w">
     </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">110</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;deck chair&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;description&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;A cozy wooden deck chair&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;weight&#34;</span><span class="p">:</span><span class="w"> </span><span class="mf">15.7</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;quantity&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;c&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1669382021990</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;before&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;paint&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;description&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;A bucket of white paint&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;weight&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;quantity&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">&#34;op&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;d&#34;</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;ts_ms&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">1669382021990</span><span class="p">,</span><span class="w">
  </span><span class="nl">&#34;before&#34;</span><span class="p">:</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">&#34;id&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">112</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;name&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;lamp&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;description&#34;</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;A green library style lamp&#34;</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;weight&#34;</span><span class="p">:</span><span class="w"> </span><span class="mf">4.8</span><span class="p">,</span><span class="w">
    </span><span class="nl">&#34;quantity&#34;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span><span class="nl">&#34;after&#34;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span><span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note not all of them have the <code>u</code> (update) operation type, but some are <code>c</code> (create) and <code>d</code> (delete) events. The logic here is that the publication works from a perspective of looking at the row set specified via the <code>WHERE</code> clause for the table. In that light,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An update event is emitted for the deck chair quantity update from 7 to 6</p>
</li>
<li>
<p>No event event is emitted for the paint quantity update from 15 to 14, as that row is not part of this row set before and after the change</p>
</li>
<li>
<p>A create event is emitted for the paint quantity update from 14 to 9, as that row now became a part of the row set</p>
</li>
<li>
<p>A delete event is emitted for the lamp quantity update from 3 to 11, as that row now is not a part of the row set any longer</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, let’s delete some product items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;lamp&#39;</span><span class="p">;</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s1">&#39;deck chair&#39;</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the Kafka topic you can observe that no change event is emitted for the first deletion (as there’s 11 lamps in stock). But there is an event for the deletion of the deck chair record with a quantity of six.</p>
</div>
<div class="paragraph">
<p>As they say, a picture is worth a thousand words (and I’d never pass on an opportunity for using my favorite tool <a href="https://excalidraw.com/">Excalidraw</a>), so here is an overview of the published events, depending on the specifics of a given data change:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/postgres15-event-flow-diagram.webp" alt="Overview of published events depending on data changes"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrap_up">Wrap-Up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Row filters (and column lists) are a great addition to the Postgres logical decoding toolbox. Having fine-grained control over which change events should be published and which field they should contain, opens up many interesting opportunities from a perspective of efficiency and data privacy as well as the ability to set up content specific change data streams, as demonstrated in the example above.</p>
</div>
<div class="paragraph">
<p>Going forward, a good next step usability-wise would be for Debezium to apply any configured row filters and column lists to the Postgres publications it creates, simplifying things for users a bit. As far as Flink SQL and Decodable are concerned, row filters and column lists potentially allow for the push down of filter and projection operators of streaming SQL queries; Instead of applying these operators within the Flink stream processing engine, SELECT and WHERE clauses of queries could be re-written transparently and these operators executed as part of the logical replication publication within Postgres itself. Flink supports this kind of push down of logic into data sources via the <code>SupportsFilterPushDown</code> and <code>SupportsProjectionPushDown</code> extension points. For example, this could be very interesting to customers who don’t want specific segments of their data to leave the realm of their database. Please reach out to us if you think this would be an interesting capability to have.</p>
</div>
<div class="paragraph">
<p>If you would like to get started with your own experimentations around 15 Postgres row filters using Debezium, you can find the complete source code of the example shown above in <a href="https://github.com/gunnarmorling/postgres-publication-filtering">this repository</a> on GitHub. You can find more information about row filters in <a href="https://www.postgresql.fastware.com/blog/introducing-publication-row-filters">this blog post</a>; also refer to <a href="http://amitkapila16.blogspot.com/2022/11/logical-replication-improvements-in.html">this post</a> to learn more about this and other new features related to logical replication in Postgres 15.</p>
</div>
<div class="paragraph">
<p><em>Many thanks to <a href="https://twitter.com/rmetzger_">Robert Metzger</a> for his feedback while writing this post!</em></p>
</div>
</div>
</div>
			</div>

			<div class="post-tags">
				
					
				
			</div>
		</div>

		<div class="post-footer">
			<div style="display: flex; align-items: center; gap: 1rem;">
				<div class="header-image-container" style="flex-shrink: 0;">
					<img class="footer-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
				</div>
				<p style="margin: 0;">Gunnar Morling is an open-source software engineer in the Java and data streaming space. He currently works as a Technologist for Confluent. In his past role at Decodable he focused on developer outreach and helped them build their stream processing platform based on Apache Flink. Prior to that, he spent ten years at Red Hat, where he led the Debezium project, a platform for change data capture.</p>
			</div>
		</div>

		
		
		<div class="post-discussions">
			<p>Comment below or join the discussion on
			<a href="https://hn.algolia.com/?query=morling.dev/blog/postgres-15-logical-decoding-row-filters-with-debezium/">Hacker News</a>,
			<a href="https://lobste.rs/search?q=domain:morling.dev+title:%22Postgres%2015%3a%20Logical%20Decoding%20Row%20Filters%20With%20Debezium%22&what=stories">Lobsters</a>, and
			<a href="https://www.reddit.com/search/?q=url:morling.dev/blog/postgres-15-logical-decoding-row-filters-with-debezium/">Reddit</a>.
			</p>
		</div>
		<div id="disqus_thread"></div>

<script>
  
  setTimeout(function() {
    const commentsContainer = document.getElementById('disqus_thread');
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', 'gunnarmorling/discussions.morling.dev');
    script.setAttribute('data-repo-id', 'R_kgDOGXzqNQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOGXzqNc4B_2Pq');
    script.setAttribute('data-mapping', 'title');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-theme', 'light');
    script.setAttribute('data-lang', 'en');
    script.setAttribute('crossorigin', 'anonymous');
    script.async = true;
    commentsContainer.appendChild(script);
  }, 0);
</script>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
