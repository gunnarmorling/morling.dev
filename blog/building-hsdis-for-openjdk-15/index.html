<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Building hsdis for OpenJDK 15 - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:url" content="https://www.morling.dev/blog/building-hsdis-for-openjdk-15/">
  <meta property="og:site_name" content="Gunnar Morling">
  <meta property="og:title" content="Building hsdis for OpenJDK 15">
  <meta property="og:description" content=" Lately I’ve been fascinated by the possibility to analyse the assembly code emitted by the Java JIT (just-in-time) compiler. So far I had only looked only into Java class files using javap; diving …">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="blog">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2020-10-05T20:30:00&#43;02:00">
    <meta property="article:modified_time" content="2020-10-05T20:30:00&#43;02:00">
<meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Building hsdis for OpenJDK 15">
  <meta name="twitter:description" content=" Lately I’ve been fascinated by the possibility to analyse the assembly code emitted by the Java JIT (just-in-time) compiler. So far I had only looked only into Java class files using javap; diving …">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
 
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/main.css" />

	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/base16.dark.css" />
	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/morlingdev.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>

	<script src="https://www.morling.dev//js/main.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/blog">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">Building hsdis for OpenJDK 15</h1>
				<div class="meta">Posted at Oct 5, 2020</div>
			</div>

			<div class="post-content">
				<div class="paragraph">
<p>Lately I’ve been fascinated by the possibility to analyse the assembly code emitted by the Java JIT (just-in-time) compiler.
So far I had only looked only into Java class files using <em>javap</em>;
diving into the world of assembly code feels a bit like Alice must have felt when falling down the rabbit whole into wonderland.</p>
</div>
<div class="paragraph">
<p>My motivation for this exploration was trying to understand what is faster in Java:
a switch statement over strings, or a lookup in a hash map.
Solely looking at Java bytecode isn’t going far enough to answer this question,
as the difference lies in the actual assembly statements executed on the CPU.
I’ll keep the details around that for another time; in this post I’m just going quickly to share what I learned in regards to building a tool needed for this exercise, <a href="https://github.com/openjdk/jdk/tree/master/src/utils/hsdis"><em>hsdis</em></a>.</p>
</div>
<div class="paragraph">
<p><em>hsdis</em> is a disassembler library which can be used with the <em>java</em> runtime as well as tools such as JitWatch to analyse the code produced by the Java JIT compiler.
For licensing reasons though it doesn’t come as a binary with the JDK.
Instead, you need it to build yourself from source.
Instructions for doing so are spread across a few different places,
but I couldn’t find any 100% current information, in particular as OpenJDK has moved to git and <a href="https://github.com/openjdk/">GitHub</a> just recently.</p>
</div>
<div class="paragraph">
<p>So here is what you need to do in order to build <em>hsdis</em> for OpenJDK 15;
in my case I’m running on macOS, slightly different steps may apply for other platforms.
First, get the OpenJDK source code and check out the version for which you want to build <em>hsdis</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>git clone git@github.com:openjdk/jdk.git
git checkout jdk-15+36 <span class="c"># Current stable JDK 15 build</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The source location of <em>hsdis</em> has changed with the move from Mercurial to git:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nb">cd </span>src/utils/hsdis
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to build <em>hsdis</em>, you’ll need the <a href="https://www.gnu.org/software/binutils/">GNU Binutils</a>, a collection of several binary tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre>wget https://ftp.gnu.org/gnu/binutils/binutils-2.35.tar.gz
<span class="nb">tar </span>xvf binutils-2.35.tar.gz
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the actual <em>hsdis</em> build (macOS comes with all the required tools like <em>make</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>make <span class="nv">BINUTILS</span><span class="o">=</span>binutils-2.35 <span class="nv">ARCH</span><span class="o">=</span>amd64
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will take a few minutes; if all goes well, there’ll be <em>hsdis</em> binary in the <em>build</em> directory,
in my case this is <em>build/macosx-amd64/hsdis-amd64.dylib</em>.
Copy the library to <em>lib/server</em> of our JDK:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nb">sudo cp </span>build/macosx-amd64/hsdis-amd64.dylib <span class="nv">$JAVA_HOME</span>/lib/server
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you’re on Linux, you also can provide the <em>hsdis</em> tool via the <code>LD_LIBRARY_PATH</code> environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:path/to/hsdis/build/linux-amd64
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note this won’t work on current macOS versions unfortunately due to its <a href="https://help.mulesoft.com/s/article/Variables-LD-LIBRARY-PATH-DYLD-LIBRARY-PATH-are-ignored-on-MAC-OS-if-System-Integrity-Protect-SIP-is-enable">System Integrity Protection</a> feature (SIP). Thanks to Brice Dutheil for this tip!</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Congrats! You now can use the <a href="https://wiki.openjdk.java.net/display/HotSpot/PrintAssembly"><code>XX:+PrintAssembly</code></a> flag of the <em>java</em> command to examine the assembly code of your Java program.
Let’s give it a try.
Create a Java source file with the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintAssemblyTest</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">PrintAssemblyTest</span> <span class="n">hello</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PrintAssemblyTest</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10_000_000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
      <span class="n">hello</span><span class="o">.</span><span class="na">hello</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">1_000_000</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compile and run it like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>javac PrintAssemblyTest.java
java <span class="nt">-XX</span>:+UnlockDiagnosticVMOptions <span class="nt">-XX</span>:+PrintAssembly <span class="se">\</span>
 <span class="nt">-Xlog</span>:class+load<span class="o">=</span>info <span class="nt">-XX</span>:+LogCompilation <span class="se">\</span>
 PrintAssemblyTest
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should then find the assembly code of the <code>hello()</code> method somewhere in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre></td><td class="code"><pre><span class="o">=============================</span> C2-compiled nmethod <span class="o">==============================</span>
<span class="nt">-----------------------------------</span> Assembly <span class="nt">-----------------------------------</span>

Compiled method <span class="o">(</span>c2<span class="o">)</span>    1409  106       4       PrintAssemblyTest::hello <span class="o">(</span>20 bytes<span class="o">)</span>
 total <span class="k">in </span>heap  <span class="o">[</span>0x000000011e3fce90,0x000000011e3fd148] <span class="o">=</span> 696
 relocation     <span class="o">[</span>0x000000011e3fcfe8,0x000000011e3fcff8] <span class="o">=</span> 16
 main code      <span class="o">[</span>0x000000011e3fd000,0x000000011e3fd080] <span class="o">=</span> 128
 stub code      <span class="o">[</span>0x000000011e3fd080,0x000000011e3fd098] <span class="o">=</span> 24
 oops           <span class="o">[</span>0x000000011e3fd098,0x000000011e3fd0a0] <span class="o">=</span> 8
 metadata       <span class="o">[</span>0x000000011e3fd0a0,0x000000011e3fd0a8] <span class="o">=</span> 8
 scopes data    <span class="o">[</span>0x000000011e3fd0a8,0x000000011e3fd0d0] <span class="o">=</span> 40
 scopes pcs     <span class="o">[</span>0x000000011e3fd0d0,0x000000011e3fd140] <span class="o">=</span> 112
 dependencies   <span class="o">[</span>0x000000011e3fd140,0x000000011e3fd148] <span class="o">=</span> 8

<span class="nt">--------------------------------------------------------------------------------</span>
<span class="o">[</span>Constant Pool <span class="o">(</span>empty<span class="o">)]</span>

<span class="nt">--------------------------------------------------------------------------------</span>

<span class="o">[</span>Entry Point]
  <span class="c"># {method} {0x000000010d74c4b0} &#39;hello&#39; &#39;(I)V&#39; in &#39;PrintAssemblyTest&#39;</span>
  <span class="c"># this:     rsi:rsi   = &#39;PrintAssemblyTest&#39;</span>
  <span class="c"># parm0:    rdx       = int</span>
  <span class="c">#           [sp+0x30]  (sp of caller)</span>
  0x000000011e3fd000:   mov    0x8<span class="o">(</span>%rsi<span class="o">)</span>,%r10d
  0x000000011e3fd004:   shl    <span class="nv">$0x3</span>,%r10
  0x000000011e3fd008:   movabs <span class="nv">$0x800000000</span>,%r11
  0x000000011e3fd012:   add    %r11,%r10
  0x000000011e3fd015:   cmp    %r10,%rax
  0x000000011e3fd018:   jne    0x0000000116977100           <span class="p">;</span>   <span class="o">{</span>runtime_call ic_miss_stub<span class="o">}</span>
  0x000000011e3fd01e:   xchg   %ax,%ax
<span class="o">[</span>Verified Entry Point]
  0x000000011e3fd020:   mov    %eax,-0x14000<span class="o">(</span>%rsp<span class="o">)</span>
  0x000000011e3fd027:   push   %rbp
  0x000000011e3fd028:   sub    <span class="nv">$0x20</span>,%rsp                   <span class="p">;</span><span class="k">*</span>synchronization entry
                                                            <span class="p">;</span> - PrintAssemblyTest::hello@-1 <span class="o">(</span>line 10<span class="o">)</span>
  0x000000011e3fd02c:   movslq %edx,%r10
  0x000000011e3fd02f:   mov    %edx,%r11d
  0x000000011e3fd032:   sar    <span class="nv">$0x1f</span>,%r11d
  0x000000011e3fd036:   imul   <span class="nv">$0x431bde83</span>,%r10,%r10
  0x000000011e3fd03d:   sar    <span class="nv">$0x32</span>,%r10
  0x000000011e3fd041:   mov    %r10d,%r10d
  0x000000011e3fd044:   sub    %r11d,%r10d
  0x000000011e3fd047:   imul   <span class="nv">$0xf4240</span>,%r10d,%r10d         <span class="p">;</span><span class="k">*</span>irem <span class="o">{</span><span class="nv">reexecute</span><span class="o">=</span>0 <span class="nv">rethrow</span><span class="o">=</span>0 <span class="nv">return_oop</span><span class="o">=</span>0<span class="o">}</span>
                                                            <span class="p">;</span> - PrintAssemblyTest::hello@3 <span class="o">(</span>line 10<span class="o">)</span>
  0x000000011e3fd04e:   cmp    %r10d,%edx
  0x000000011e3fd051:   je     0x000000011e3fd063           <span class="p">;</span><span class="k">*</span>ifne <span class="o">{</span><span class="nv">reexecute</span><span class="o">=</span>0 <span class="nv">rethrow</span><span class="o">=</span>0 <span class="nv">return_oop</span><span class="o">=</span>0<span class="o">}</span>
                                                            <span class="p">;</span> - PrintAssemblyTest::hello@4 <span class="o">(</span>line 10<span class="o">)</span>
  0x000000011e3fd053:   add    <span class="nv">$0x20</span>,%rsp
  0x000000011e3fd057:   pop    %rbp
  0x000000011e3fd058:   mov    0x110<span class="o">(</span>%r15<span class="o">)</span>,%r10
  0x000000011e3fd05f:   <span class="nb">test</span>   %eax,<span class="o">(</span>%r10<span class="o">)</span>                  <span class="p">;</span>   <span class="o">{</span>poll_return<span class="o">}</span>
  0x000000011e3fd062:   retq
  0x000000011e3fd063:   mov    %edx,%ebp
  0x000000011e3fd065:   sub    %r10d,%ebp                   <span class="p">;</span><span class="k">*</span>irem <span class="o">{</span><span class="nv">reexecute</span><span class="o">=</span>0 <span class="nv">rethrow</span><span class="o">=</span>0 <span class="nv">return_oop</span><span class="o">=</span>0<span class="o">}</span>
                                                            <span class="p">;</span> - PrintAssemblyTest::hello@3 <span class="o">(</span>line 10<span class="o">)</span>
  0x000000011e3fd068:   mov    <span class="nv">$0xffffff45</span>,%esi
  0x000000011e3fd06d:   mov    %edx,<span class="o">(</span>%rsp<span class="o">)</span>
  0x000000011e3fd070:   data16 xchg %ax,%ax
  0x000000011e3fd073:   callq  0x0000000116979080           <span class="p">;</span> ImmutableOopMap <span class="o">{}</span>
                                                            <span class="p">;</span><span class="k">*</span>ifne <span class="o">{</span><span class="nv">reexecute</span><span class="o">=</span>1 <span class="nv">rethrow</span><span class="o">=</span>0 <span class="nv">return_oop</span><span class="o">=</span>0<span class="o">}</span>
                                                            <span class="p">;</span> - <span class="o">(</span>reexecute<span class="o">)</span> PrintAssemblyTest::hello@4 <span class="o">(</span>line 10<span class="o">)</span>
                                                            <span class="p">;</span>   <span class="o">{</span>runtime_call UncommonTrapBlob<span class="o">}</span>
  0x000000011e3fd078:   hlt
  0x000000011e3fd079:   hlt
  0x000000011e3fd07a:   hlt
  0x000000011e3fd07b:   hlt
  0x000000011e3fd07c:   hlt
  0x000000011e3fd07d:   hlt
  0x000000011e3fd07e:   hlt
  0x000000011e3fd07f:   hlt
<span class="o">[</span>Exception Handler]
  0x000000011e3fd080:   jmpq   0x0000000116a22d80           <span class="p">;</span>   <span class="o">{</span>no_reloc<span class="o">}</span>
<span class="o">[</span>Deopt Handler Code]
  0x000000011e3fd085:   callq  0x000000011e3fd08a
  0x000000011e3fd08a:   subq   <span class="nv">$0x5</span>,<span class="o">(</span>%rsp<span class="o">)</span>
  0x000000011e3fd08f:   jmpq   0x0000000116978ca0           <span class="p">;</span>   <span class="o">{</span>runtime_call DeoptimizationBlob<span class="o">}</span>
  0x000000011e3fd094:   hlt
  0x000000011e3fd095:   hlt
  0x000000011e3fd096:   hlt
  0x000000011e3fd097:   hlt
<span class="nt">--------------------------------------------------------------------------------</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Interpreting the output is left as an exercise for the astute reader ;-)
A great resource for getting started doing so is the post <a href="https://jpbempel.github.io/2015/12/30/printassembly-output-explained.html">PrintAssembly output explained!</a> by <a href="https://twitter.com/jpbempel">Jean-Philippe Bempel</a>.</p>
</div>
<div class="paragraph">
<p>With <em>hsdis</em> in place, you also can use the excellent <a href="https://github.com/AdoptOpenJDK/jitwatch">JitWatch</a> tool for analysing the assembly code,
which e.g. not only provides an easy way to navigate from source code to byte code to assembly code,
but also comes with helpful tooltips explaining the meaning of the different assembly mnemonics.</p>
</div>
			</div>

			<div class="post-tags">
				
					
				
			</div>
		</div>

		<div class="post-footer">
			<div style="display: flex; align-items: center; gap: 1rem;">
				<div class="header-image-container" style="flex-shrink: 0;">
					<img class="footer-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
				</div>
				<p style="margin: 0;">Gunnar Morling is an open-source software engineer in the Java and data streaming space. He currently works as a Technologist for Confluent. In his past role at Decodable he focused on developer outreach and helped them build their stream processing platform based on Apache Flink. Prior to that, he spent ten years at Red Hat, where he led the Debezium project, a platform for change data capture.</p>
			</div>
		</div>

		
		
		<div class="post-discussions">
			<p>Comment below or join the discussion on
			<a href="https://hn.algolia.com/?query=morling.dev/blog/building-hsdis-for-openjdk-15/">Hacker News</a>,
			<a href="https://lobste.rs/search?q=domain:morling.dev+title:%22Building%20hsdis%20for%20OpenJDK%2015%22&what=stories">Lobsters</a>, and
			<a href="https://www.reddit.com/search/?q=url:morling.dev/blog/building-hsdis-for-openjdk-15/">Reddit</a>.
			</p>
		</div>
		<div id="disqus_thread"></div>

<script>
  
  setTimeout(function() {
    const commentsContainer = document.getElementById('disqus_thread');
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', 'gunnarmorling/discussions.morling.dev');
    script.setAttribute('data-repo-id', 'R_kgDOGXzqNQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOGXzqNc4B_2Pq');
    script.setAttribute('data-mapping', 'title');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-theme', 'light');
    script.setAttribute('data-lang', 'en');
    script.setAttribute('crossorigin', 'anonymous');
    script.async = true;
    commentsContainer.appendChild(script);
  }, 0);
</script>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a> | <a href="/ai">How I use (and don't use) AI</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
