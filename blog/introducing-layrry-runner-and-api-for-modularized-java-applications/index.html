<!DOCTYPE html>
<html>
<head>
	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-DD997656SV"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-DD997656SV');
	</script>

	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Introducing Layrry: A Launcher and API for Modularized Java Applications - Gunnar Morling</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Introducing Layrry: A Launcher and API for Modularized Java Applications" />
<meta property="og:description" content="
One of the biggest changes in recent Java versions has been the introduction of the module system in Java 9.
It allows to organize Java applications and their dependencies in strongly encapsulated modules, utilizing explicit and well-defined module APIs and relationships.


In this post I’m going to introduce the Layrry open-source project, a launcher and Java API for executing modularized Java applications.
Layrry helps Java developers to assemble modularized applications from dependencies using their Maven coordinates and execute them using module layers.
Layers go beyond the capabilities of the &#34;flat&#34; module path specified via the --module-path parameter of the java command,
e.g. allowing to use multiple versions of one module within one and the same application.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.morling.dev/blog/introducing-layrry-runner-and-api-for-modularized-java-applications/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-03-29T21:31:00+02:00" />
<meta property="article:modified_time" content="2020-03-29T21:31:00+02:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Introducing Layrry: A Launcher and API for Modularized Java Applications"/>
<meta name="twitter:description" content="
One of the biggest changes in recent Java versions has been the introduction of the module system in Java 9.
It allows to organize Java applications and their dependencies in strongly encapsulated modules, utilizing explicit and well-defined module APIs and relationships.


In this post I’m going to introduce the Layrry open-source project, a launcher and Java API for executing modularized Java applications.
Layrry helps Java developers to assemble modularized applications from dependencies using their Maven coordinates and execute them using module layers.
Layers go beyond the capabilities of the &#34;flat&#34; module path specified via the --module-path parameter of the java command,
e.g. allowing to use multiple versions of one module within one and the same application.
"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
 
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.morling.dev/css/main.css" />

	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/base16.dark.css" />
	
	<link rel="stylesheet" type="text/css" href="https://www.morling.dev/css/morlingdev.css" />
	

	<script>
		const searchUrl = "https:\/\/search-morling-dev.onrender.com\/";
		const apiKey = "ff90d45f4afad3bd914c";
	</script>

	<script src="https://www.morling.dev//js/main.js"></script>
	<script src="https://www.morling.dev//js/medium-zoom.min.js"></script>

	<noscript>
		<style type="text/css">
			.club { display:none; }
		</style>
	</noscript>
</head>

<body>
	<div class="container wrapper post">
		<div class="header desktop">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>

			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myForm">
							<input type="text" id="inputSearch" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearch" style="line-height: normal;"><i id="iconSearch" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<div class="header mobile">

	<div class="row">
		<div class="header-image-container">
			<img class="header-image" src="/images/gunnar_morling.jpg" alt="Gunnar Morling">
		</div>
		<div class="fill">
			<h1 class="site-title"><a href="https://www.morling.dev/">Gunnar Morling</a></h1>
			<div class="site-description"><h2>Random Musings on All Things Software Engineering</h2></div>
		</div>
	</div>
	<div>
		<div>
			<nav class="row pre-nav">
				<div class="pull-right">
					<ul class="flat"><li>
							<a href="/blog/index.xml" title="RSS FEED">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#rss"/>
								</svg>
							</a>
						</li><li>
							<a href="https://github.com/gunnarmorling" title="GitHub">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#github"/>
								</svg>
							</a>
						</li><li>
							<a href="https://bsky.app/profile/gunnarmorling.dev" title="Bluesky">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#cloud"/>
								</svg>
							</a>
						</li><li>
							<a href="https://twitter.com/gunnarmorling" title="Twitter">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#twitter"/>
								</svg>
							</a>
						</li><li>
							<a href="https://www.linkedin.com/in/gunnar-morling/" title="LinkedIn">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#linkedin"/>
								</svg>
							</a>
						</li><li>
							<a href="https://mastodon.online/@gunnarmorling" title="Mastodon">
								<svg width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<use xlink:href="/svg/feather-sprite.svg#message-square"/>
								</svg>
							</a>
						</li></ul>
				</div>
			</nav>
			<nav class="row nav">
				<div>
					<ul class="flat">
						
						<li>
							<a href="/">Blog</a>
						</li>
						
						<li>
							<a href="/projects/">Projects</a>
						</li>
						
						<li>
							<a href="/conferences/">Conferences</a>
						</li>
						
						<li>
							<a href="/podcasts/">Podcasts</a>
						</li>
						
						<li>
							<a href="/about/">About</a>
						</li>
						
					</ul>
				</div>
				<div class="pull-right">
					<div class="club">
						<form id="myFormMobile">
							<input type="text" id="inputSearchMobile" name="q" placeholder="Search..." onfocus="warmUp(this)">
							<button type="submit" id="buttonSubmitSearchMobile" style="line-height: normal;"><i id="iconSearchMobile" class="fa fa-search"></i></button>
						</form>
					</div>
				</div>
			</nav>
		</div>
	</div>
</div>

<script type="text/javascript">
	window.addEventListener( "load", function () {
		const urlParams = new URLSearchParams(window.location.search);

		


		const form = document.getElementById( "myForm" );

		form.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(form));
		});

		const formMobile = document.getElementById( "myFormMobile" );

		formMobile.addEventListener("submit", function (event) {
			event.preventDefault();
			sendData(new FormData(formMobile));
		});
	});
</script>


		<div id = "main-content">
			<div class="post-header">
				<h1 class="title">Introducing Layrry: A Launcher and API for Modularized Java Applications</h1>
				<div class="meta">Posted at Mar 29, 2020</div>
			</div>

			<div class="markdown">
				<div class="paragraph">
<p>One of the biggest changes in recent Java versions has been the introduction of the <a href="http://openjdk.java.net/projects/jigsaw/spec/">module system</a> in Java 9.
It allows to organize Java applications and their dependencies in strongly encapsulated modules, utilizing explicit and well-defined module APIs and relationships.</p>
</div>
<div class="paragraph">
<p>In this post I’m going to introduce the <a href="https://github.com/moditect/layrry">Layrry</a> open-source project, a launcher and Java API for executing modularized Java applications.
Layrry helps Java developers to assemble modularized applications from dependencies using their Maven coordinates and execute them using module layers.
Layers go beyond the capabilities of the &#34;flat&#34; module path specified via the <em>--module-path</em> parameter of the <em>java</em> command,
e.g. allowing to use multiple versions of one module within one and the same application.</p>
</div>
<div class="sect1">
<h2 id="_why_layrry">Why Layrry?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Java Module System doesn’t define any means of mapping between modules (e.g. <em>com.acme.crm</em>) and JARs providing such module
(e.g. <em>acme-crm-1.0.0.Final.jar</em>), or retrieving modules from remote repositories using unique identifiers (e.g. <em>com.acme:acme-crm:1.0.0.Final</em>).
Instead, it’s the responsibility of the user to obtain all required JARs of a modularized application and provide them via the <em>--module-path</em> parameter.</p>
</div>
<div class="paragraph">
<p>Furthermore, the module system doesn’t define any means of module versioning;
i.e. it’s the responsibility of the user to obtain all modules in the right version.
Using the <em>--module-path</em> option, it’s not possible, though, to assemble an application that uses multiple versions of one and the same module.
This may be desirable for transitive dependencies of an application,
which might be required in different versions by two separate direct dependencies.</p>
</div>
<div class="paragraph">
<p>This is where Layrry comes in (pronounced <a href="https://en.wikipedia.org/wiki/Larry_Laffer">&#34;Larry&#34;</a>):
it provides a declarative approach as well as an API for assembling modularized applications.
The (modular) JARs to be included are described using Maven GAV (group id, artifact id, version) coordinates,
solving the issue of retrieving all required JARs from a remote repository,
in the right version.</p>
</div>
<div class="paragraph">
<p>With Layrry, applications are organized in <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ModuleLayer.html">module layers</a>,
which allows to use different versions of one and the same module in different layers of an application
(as long as they are not exposed in a conflicting way on module API boundaries).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_an_example">An Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an example, let’s consider an application made up of the following modules:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/layrry-example.png" alt="layrry example"/>
</div>
</div>
<div class="paragraph">
<p>The application’s main module, <em>com.example:app</em>, depends on two others, <em>com.example:foo</em> and <em>com.example:bar</em>.
They in turn depend on the Log4j API and another module, <em>com.example:greeter</em>.
The latter is used in two different versions, though.</p>
</div>
<div class="paragraph">
<p>Let’s take a closer look at the <code>Greeter</code> class in these modules.
Here is the version in <em>com.example:greeter@1.0.0</em>,
as used by <em>com.example:foo</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Greeter</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">greet</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">from</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34; from &#34;</span> <span class="o">+</span> <span class="n">from</span> <span class="o">+</span> <span class="s">&#34; (Greeter 1.0.0)&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is how it looks in <em>com.example:greeter@2.0.0</em>,
as used by <em>com.example:bar</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Greeter</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">hello</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">from</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34; from &#34;</span> <span class="o">+</span> <span class="n">from</span> <span class="o">+</span> <span class="s">&#34; (Greeter 2.0.0)&#34;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">goodBye</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">from</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&#34;Good bye, &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34; from &#34;</span> <span class="o">+</span> <span class="n">from</span> <span class="o">+</span>
                <span class="s">&#34; (Greeter 2.0.0)&#34;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Greeter</code> API has evolved in a backwards-incompatible way,
i.e. it’s not possible for the <em>foo</em> and <em>bar</em> modules to use the same version.</p>
</div>
<div class="paragraph">
<p>With a &#34;flat&#34; module path (or classpath),
there’s no way for dealing with this situation.
You’d inevitably end up with a <code>NoSuchMethodError</code>,
as either <em>foo</em> or <em>bar</em> would be linked at runtime against a version of the class different from the version it has been compiled against.</p>
</div>
<div class="paragraph">
<p>The lack of support for using multiple module versions when working with the <em>--module-path</em> option might be surprising at first,
but it’s an <a href="http://openjdk.java.net/projects/jigsaw/spec/reqs/02#non-requirements">explicit</a> non-requirement of the module system to support multiple module versions or even deal with selecting matching module versions at all.</p>
</div>
<div class="paragraph">
<p>This means that the module descriptors of both <em>foo</em> and <em>bar</em> require the <em>greeter</em> module without any version information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="n">module</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">foo</span> <span class="o">{</span>
    <span class="n">exports</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">foo</span><span class="o">;</span>
    <span class="n">requires</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">log4j</span><span class="o">;</span>
    <span class="n">requires</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">greeter</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="n">module</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">bar</span> <span class="o">{</span>
    <span class="n">exports</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">bar</span><span class="o">;</span>
    <span class="n">requires</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">log4j</span><span class="o">;</span>
    <span class="n">requires</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">greeter</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_layers_to_the_rescue">Module Layers to the Rescue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While only one version of a given module is supported when running applications via <em>java --module-path=…​</em>,
there’s a lesser known feature of the module system which provides a way out: module layers.</p>
</div>
<div class="paragraph">
<p>A <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ModuleLayer.html">module layer</a> &#34;is created from a graph of modules in a <code>Configuration</code> and a function that maps each module to a <code>ClassLoader</code>.&#34;
Using the module layer API,
multiple versions of a module can be loaded in different layers,
thus using different classloaders.</p>
</div>
<div class="paragraph">
<p>Note the layers API doesn’t concern itself with obtaining JARs or modules from remote locations such as the Maven Central repository;
instead, any modules must be provided as <code>Path</code> objects.
Here is how a layer with the <em>foo</em> and <em>greeter:1.0.0</em> modules could be assembled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="nc">ModuleLayer</span> <span class="n">boot</span> <span class="o">=</span> <span class="nc">ModuleLayer</span><span class="o">.</span><span class="na">boot</span><span class="o">();</span>
<span class="nc">ClassLoader</span> <span class="n">scl</span> <span class="o">=</span> <span class="nc">ClassLoader</span><span class="o">.</span><span class="na">getSystemClassLoader</span><span class="o">();</span>

<span class="nc">Path</span> <span class="n">foo</span> <span class="o">=</span> <span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;path/to/foo-1.0.0.jar&#34;</span><span class="o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nc">Path</span> <span class="n">greeter10</span> <span class="o">=</span> <span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;path/to/greeter-1.0.0.jar&#34;</span><span class="o">);</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="nc">ModuleFinder</span> <span class="n">fooFinder</span> <span class="o">=</span> <span class="nc">ModuleFinder</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">foo</span><span class="o">,</span> <span class="n">greeter10</span><span class="o">);</span>
<span class="nc">Configuration</span> <span class="n">fooConfig</span> <span class="o">=</span> <span class="n">boot</span><span class="o">.</span><span class="na">configuration</span><span class="o">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="o">.</span><span class="na">resolve</span><span class="o">(</span>
          <span class="n">fooFinder</span><span class="o">,</span>
          <span class="nc">ModuleFinder</span><span class="o">.</span><span class="na">of</span><span class="o">(),</span>
          <span class="nc">Set</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;com.example.foo&#34;</span><span class="o">,</span> <span class="s">&#34;com.example.greeter&#34;</span><span class="o">)</span>
    <span class="o">);</span>
<span class="nc">ModuleLayer</span> <span class="n">fooLayer</span> <span class="o">=</span> <span class="n">boot</span><span class="o">.</span><span class="na">defineModulesWithOneLoader</span><span class="o">(</span>
        <span class="n">fooConfig</span><span class="o">,</span> <span class="n">scl</span><span class="o">);</span> <i class="conum" data-value="4"></i><b>(4)</b>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>obtain foo-1.0.0.jar</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>obtain greeter-1.0.0.jar</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create a configuration derived from the &#34;boot&#34; module of the JVM,
providing a <code>ModuleFinder</code> for the two JARs obtained before, and resolving the two modules</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create a module layer using the configuration, loading all contained modules with a single classloader</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Similarly, you could create a layer for <em>bar</em> and <em>greeter:2.0.0</em>,
as well as layers for log4j and the main application module.
The layers API is very flexible, e.g. you could load each module in its own classloader and more.
But all this flexibility can make using the API direcly a daunting task.</p>
</div>
<div class="paragraph">
<p>Also using an API might not be what you want in the first place:
wouldn’t it be nice if there was a CLI tool,
akin to using <em>java --module-path=…​</em>,
but with the additional powers of module layers?</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_layrry_launcher">The Layrry Launcher</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is where Layrry comes in:
it is a CLI tool which takes a configuration of a layered application
(defined in a YAML file) and executes it.
The layer descriptor for the example above looks like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span class="na">layers</span><span class="pi">:</span>
  <span class="na">log</span><span class="pi">:</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="na">modules</span><span class="pi">:</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">org.apache.logging.log4j:log4j-api:jar:2.13.1&#34;</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">org.apache.logging.log4j:log4j-core:jar:2.13.1&#34;</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">com.example:logconfig:1.0.0&#34;</span>
  <span class="na">foo</span><span class="pi">:</span>
    <span class="na">parents</span><span class="pi">:</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">log&#34;</span>
    <span class="na">modules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">com.example:greeter:1.0.0&#34;</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">com.example:foo:1.0.0&#34;</span>
  <span class="na">bar</span><span class="pi">:</span>
    <span class="na">parents</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">log&#34;</span>
    <span class="na">modules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">com.example:greeter:2.0.0&#34;</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">com.example:bar:1.0.0&#34;</span>
  <span class="na">app</span><span class="pi">:</span>
    <span class="na">parents</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">foo&#34;</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">bar&#34;</span>
    <span class="na">modules</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">&#34;</span><span class="s">com.example:app:1.0.0&#34;</span>
<span class="na">main</span><span class="pi">:</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="na">module</span><span class="pi">:</span> <span class="s">com.example.app</span>
  <span class="na">class</span><span class="pi">:</span> <span class="s">com.example.app.App</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each layer has a unique name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>modules</code> element lists all the modules contained in the layer, using Maven coordinates (group id, artifact id, version), unambigously referencing a (modular) JAR in a specific version</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A layer can have one or more parent layers, whose modules it can access;
if no parent is given, the JVM’s &#34;boot&#34; layer is the implicit parent of a layer</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The given main module and class is the one that will be executed by Layrry</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The configuration above describes four layers, <em>log</em>, <em>foo</em>, <em>bar</em> and <em>app</em>,
with the modules they contain and the parent/child relationships between these layers.
Note how the versions 1.0.0 and 2.0.0 of the <em>greeter</em> module are used in <em>foo</em> and <em>bar</em>.
The file also specifies the main class to execute when running this application.</p>
</div>
<div class="paragraph">
<p>Using Layrry, a modular application is executed like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre>java <span class="nt">-jar</span> layrry-1.0-SNAPSHOT-jar-with-dependencies.jar <span class="se">\</span>
    <span class="nt">--layers-config</span> layers.yml <span class="se">\</span>
    Alice

20:58:01.451 <span class="o">[</span>main] INFO  com.example.foo.Foo - Hello, Alice from Foo <span class="o">(</span>Greeter 1.0.0<span class="o">)</span>
20:58:01.472 <span class="o">[</span>main] INFO  com.example.bar.Bar - Hello, Alice from Bar <span class="o">(</span>Greeter 2.0.0<span class="o">)</span>
20:58:01.473 <span class="o">[</span>main] INFO  com.example.bar.Bar - Good bye, Alice from Bar <span class="o">(</span>Greeter 2.0.0<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The log messages show how the two versions of <em>greeter</em> are used by <em>foo</em> and <em>bar</em>, respectively.
Layrry will download all referenced JARs using the Maven resolver API,
i.e. you don’t have to deal with manually obtaining all the JARs and providing them to the <em>java</em> runtime.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_layrry_api">Using the Layrry API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to the YAML-based launcher, Layrry provides also a Java API for assembling and running layered applications.
This can be used in cases where the structure of layers is only known at runtime,
or for implementing plug-in architectures.</p>
</div>
<div class="paragraph">
<p>In order to use Layrry programmatically, add the following dependency to your <em>pom.xml</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.moditect.layrry<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>layrry<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, the Layrry Java API can be used like this (showing the same example as above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="nc">Layers</span> <span class="n">layers</span> <span class="o">=</span> <span class="nc">Layers</span><span class="o">.</span><span class="na">layer</span><span class="o">(</span><span class="s">&#34;log&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;org.apache.logging.log4j:log4j-api:jar:2.13.1&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;org.apache.logging.log4j:log4j-core:jar:2.13.1&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;com.example:logconfig:1.0.0&#34;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">layer</span><span class="o">(</span><span class="s">&#34;foo&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withParent</span><span class="o">(</span><span class="s">&#34;log&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;com.example:greeter:1.0.0&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;com.example:foo:1.0.0&#34;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">layer</span><span class="o">(</span><span class="s">&#34;bar&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withParent</span><span class="o">(</span><span class="s">&#34;log&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;com.example:greeter:2.0.0&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;com.example:bar:1.0.0&#34;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">layer</span><span class="o">(</span><span class="s">&#34;app&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withParent</span><span class="o">(</span><span class="s">&#34;foo&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withParent</span><span class="o">(</span><span class="s">&#34;bar&#34;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">withModule</span><span class="o">(</span><span class="s">&#34;com.example:app:1.0.0&#34;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="n">layers</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="s">&#34;com.example.app/com.example.app.App&#34;</span><span class="o">,</span> <span class="s">&#34;Alice&#34;</span><span class="o">);</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps">Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Layrry project is still in its infancy.
Nevertheless it can be a useful tool for application developers wishing to leverage the Java Module System.
Obtaining modular JARs via Maven coordinates and providing an easy-to-use mechanism for organizing modules in layers enables usages which cannot be addressed using the plain <em>java --module-path …​</em> approach.</p>
</div>
<div class="paragraph">
<p>Layrry is open-source (under the Apache License version 2.0).
The <a href="https://github.com/moditect/layrry">source code</a> is hosted on GitHub,
and your contributions are very welcomed.</p>
</div>
<div class="paragraph">
<p>Please let me know about your ideas and requirements in the comments below or by opening up issues on GitHub.
Planned enhancements include support for creating modular runtime images (<em>jlink</em>) based on the modules referenced in a <em>layers.yml</em> file,
and visualization of module layers and their modules via GraphViz.</p>
</div>
</div>
</div>
			</div>

			<div class="post-tags">
				
					
				
			</div>
		</div><div id="disqus_thread">
  <script src="https://giscus.app/client.js"
    data-repo="gunnarmorling/discussions.morling.dev"
    data-repo-id="R_kgDOGXzqNQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOGXzqNc4B_2Pq"
    data-mapping="title"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async>
  </script>
</div>

<noscript>Please enable JavaScript, or join the <a href="https://github.com/gunnarmorling/discussions.morling.dev/discussions/">discussion on GitHub</a>.</noscript>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 - 2025 Gunnar Morling |  Licensed Under <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons BY-SA 4.0</a></div>
	</nav>
</div><script>
	mediumZoom(document.querySelectorAll('div.imageblock > div.content > img'))
</script>

</body>
</html>
